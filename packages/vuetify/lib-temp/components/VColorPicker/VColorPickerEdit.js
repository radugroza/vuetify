// Styles
import './VColorPickerEdit.sass';
// Components
import VBtn from '../VBtn';
import VIcon from '../VIcon';
// Helpers
import { parseHex } from '../../util/colorUtils';
// Types
import Vue from 'vue';
import { fromRGBA, fromHexa, fromHSLA } from './util';
export const modes = {
    rgba: {
        inputs: [
            ['r', 255, 'int'],
            ['g', 255, 'int'],
            ['b', 255, 'int'],
            ['a', 1, 'float'],
        ],
        from: fromRGBA,
    },
    hsla: {
        inputs: [
            ['h', 360, 'int'],
            ['s', 1, 'float'],
            ['l', 1, 'float'],
            ['a', 1, 'float'],
        ],
        from: fromHSLA,
    },
    hexa: {
        from: fromHexa,
    },
};
export default Vue.extend({
    name: 'v-color-picker-edit',
    props: {
        color: Object,
        disabled: Boolean,
        hideAlpha: Boolean,
        hideModeSwitch: Boolean,
        mode: {
            type: String,
            default: 'rgba',
            validator: (v) => Object.keys(modes).includes(v),
        },
    },
    data() {
        return {
            modes,
            internalMode: this.mode,
        };
    },
    computed: {
        currentMode() {
            return this.modes[this.internalMode];
        },
    },
    watch: {
        mode(mode) {
            this.internalMode = mode;
        },
    },
    created() {
        this.internalMode = this.mode;
    },
    methods: {
        getValue(v, type) {
            if (type === 'float')
                return Math.round(v * 100) / 100;
            else if (type === 'int')
                return Math.round(v);
            else
                return 0;
        },
        parseValue(v, type) {
            if (type === 'float')
                return parseFloat(v);
            else if (type === 'int')
                return parseInt(v, 10) || 0;
            else
                return 0;
        },
        changeMode() {
            const modes = Object.keys(this.modes);
            const index = modes.indexOf(this.internalMode);
            const newMode = modes[(index + 1) % modes.length];
            this.internalMode = newMode;
            this.$emit('update:mode', newMode);
        },
        genInput(target, attrs, value, on) {
            return this.$createElement('div', {
                staticClass: 'v-color-picker__input',
            }, [
                this.$createElement('input', {
                    key: target,
                    attrs,
                    domProps: {
                        value,
                    },
                    on,
                }),
                this.$createElement('span', target.toUpperCase()),
            ]);
        },
        genInputs() {
            switch (this.internalMode) {
                case 'hexa': {
                    const hex = this.color.hexa;
                    const value = this.hideAlpha && hex.endsWith('FF') ? hex.substr(0, 7) : hex;
                    return this.genInput('hex', {
                        maxlength: this.hideAlpha ? 7 : 9,
                        disabled: this.disabled,
                    }, value, {
                        change: (e) => {
                            const el = e.target;
                            this.$emit('update:color', this.currentMode.from(parseHex(el.value)));
                        },
                    });
                }
                default: {
                    const inputs = this.hideAlpha ? this.currentMode.inputs.slice(0, -1) : this.currentMode.inputs;
                    return inputs.map(([target, max, type]) => {
                        const value = this.color[this.internalMode];
                        return this.genInput(target, {
                            type: 'number',
                            min: 0,
                            max,
                            step: type === 'float' ? '0.01' : type === 'int' ? '1' : undefined,
                            disabled: this.disabled,
                        }, this.getValue(value[target], type), {
                            input: (e) => {
                                const el = e.target;
                                const newVal = this.parseValue(el.value || '0', type);
                                this.$emit('update:color', this.currentMode.from(Object.assign({}, value, { [target]: newVal }), this.color.alpha));
                            },
                        });
                    });
                }
            }
        },
        genSwitch() {
            return this.$createElement(VBtn, {
                props: {
                    small: true,
                    icon: true,
                    disabled: this.disabled,
                },
                on: {
                    click: this.changeMode,
                },
            }, [
                this.$createElement(VIcon, '$unfold'),
            ]);
        },
    },
    render(h) {
        return h('div', {
            staticClass: 'v-color-picker__edit',
        }, [
            this.genInputs(),
            !this.hideModeSwitch && this.genSwitch(),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkNvbG9yUGlja2VyRWRpdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZDb2xvclBpY2tlci9WQ29sb3JQaWNrZXJFZGl0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFNBQVM7QUFDVCxPQUFPLHlCQUF5QixDQUFBO0FBRWhDLGFBQWE7QUFDYixPQUFPLElBQUksTUFBTSxTQUFTLENBQUE7QUFDMUIsT0FBTyxLQUFLLE1BQU0sVUFBVSxDQUFBO0FBRTVCLFVBQVU7QUFDVixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFFaEQsUUFBUTtBQUNSLE9BQU8sR0FBd0IsTUFBTSxLQUFLLENBQUE7QUFDMUMsT0FBTyxFQUFxQixRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLFFBQVEsQ0FBQTtBQVN4RSxNQUFNLENBQUMsTUFBTSxLQUFLLEdBQUc7SUFDbkIsSUFBSSxFQUFFO1FBQ0osTUFBTSxFQUFFO1lBQ04sQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQztZQUNqQixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDO1lBQ2pCLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLENBQUM7WUFDakIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLE9BQU8sQ0FBQztTQUNsQjtRQUNELElBQUksRUFBRSxRQUFRO0tBQ2Y7SUFDRCxJQUFJLEVBQUU7UUFDSixNQUFNLEVBQUU7WUFDTixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDO1lBQ2pCLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxPQUFPLENBQUM7WUFDakIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLE9BQU8sQ0FBQztZQUNqQixDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDO1NBQ2xCO1FBQ0QsSUFBSSxFQUFFLFFBQVE7S0FDZjtJQUNELElB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QkFDL0IsS0FBSyxFQUFFO29CQUNMLEtBQUssRUFBRSxJQUFJO29CQUNYLElBQUksRUFBRSxJQUFJO29CQUNWLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtpQkFDeEI7Z0JBQ0QsRUFBRSxFQUFFO29CQUNGLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVTtpQkFDdkI7YUFDRixFQUFFO2dCQUNELElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQzthQUN0QyxDQUFDLENBQUE7UUFDSixDQUFDO0tBQ0Y7SUFFRCxNQUFNLENBQUUsQ0FBQztRQUNQLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRTtZQUNkLFdBQVcsRUFBRSxzQkFBc0I7U0FDcEMsRUFBRTtZQUNELElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEIsQ0FBQyxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7U0FDekMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFN0eWxlc1xuaW1wb3J0ICcuL1ZDb2xvclBpY2tlckVkaXQuc2FzcydcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IFZCdG4gZnJvbSAnLi4vVkJ0bidcbmltcG9ydCBWSWNvbiBmcm9tICcuLi9WSWNvbidcblxuLy8gSGVscGVyc1xuaW1wb3J0IHsgcGFyc2VIZXggfSBmcm9tICcuLi8uLi91dGlsL2NvbG9yVXRpbHMnXG5cbi8vIFR5cGVzXG5pbXBvcnQgVnVlLCB7IFZOb2RlLCBQcm9wVHlwZSB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IFZDb2xvclBpY2tlckNvbG9yLCBmcm9tUkdCQSwgZnJvbUhleGEsIGZyb21IU0xBIH0gZnJvbSAnLi91dGlsJ1xuXG50eXBlIElucHV0ID0gW3N0cmluZywgbnVtYmVyLCBzdHJpbmddXG5cbmV4cG9ydCB0eXBlIE1vZGUgPSB7XG4gIGlucHV0cz86IElucHV0W11cbiAgZnJvbTogRnVuY3Rpb25cbn1cblxuZXhwb3J0IGNvbnN0IG1vZGVzID0ge1xuICByZ2JhOiB7XG4gICAgaW5wdXRzOiBbXG4gICAgICBbJ3InLCAyNTUsICdpbnQnXSxcbiAgICAgIFsnZycsIDI1NSwgJ2ludCddLFxuICAgICAgWydiJywgMjU1LCAnaW50J10sXG4gICAgICBbJ2EnLCAxLCAnZmxvYXQnXSxcbiAgICBdLFxuICAgIGZyb206IGZyb21SR0JBLFxuICB9LFxuICBoc2xhOiB7XG4gICAgaW5wdXRzOiBbXG4gICAgICBbJ2gnLCAzNjAsICdpbnQnXSxcbiAgICAgIFsncycsIDEsICdmbG9hdCddLFxuICAgICAgWydsJywgMSwgJ2Zsb2F0J10sXG4gICAgICBbJ2EnLCAxLCAnZmxvYXQnXSxcbiAgICBdLFxuICAgIGZyb206IGZyb21IU0xBLFxuICB9LFxuICBoZXhhOiB7XG4gICAgZnJvbTogZnJvbUhleGEsXG4gIH0sXG59IGFzIHsgW2tleTogc3RyaW5nXTogTW9kZSB9XG5cbmV4cG9ydCBkZWZhdWx0IFZ1ZS5leHRlbmQoe1xuICBuYW1lOiAndi1jb2xvci1waWNrZXItZWRpdCcsXG5cbiAgcHJvcHM6IHtcbiAgICBjb2xvcjogT2JqZWN0IGFzIFByb3BUeXBlPFZDb2xvclBpY2tlckNvbG9yPixcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcbiAgICBoaWRlQWxwaGE6IEJvb2xlYW4sXG4gICAgaGlkZU1vZGVTd2l0Y2g6IEJvb2xlYW4sXG4gICAgbW9kZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ3JnYmEnLFxuICAgICAgdmFsaWRhdG9yOiAodjogc3RyaW5nKSA9PiBPYmplY3Qua2V5cyhtb2RlcykuaW5jbHVkZXModiksXG4gICAgfSxcbiAgfSxcblxuICBkYXRhICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kZXMsXG4gICAgICBpbnRlcm5hbE1vZGU6IHRoaXMubW9kZSxcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZWQ6IHtcbiAgICBjdXJyZW50TW9kZSAoKTogTW9kZSB7XG4gICAgICByZXR1cm4gdGhpcy5tb2Rlc1t0aGlzLmludGVybmFsTW9kZV1cbiAgICB9LFxuICB9LFxuXG4gIHdhdGNoOiB7XG4gICAgbW9kZSAobW9kZSkge1xuICAgICAgdGhpcy5pbnRlcm5hbE1vZGUgPSBtb2RlXG4gICAgfSxcbiAgfSxcblxuICBjcmVhdGVkICgpIHtcbiAgICB0aGlzLmludGVybmFsTW9kZSA9IHRoaXMubW9kZVxuICB9LFxuXG4gIG1ldGhvZHM6IHtcbiAgICBnZXRWYWx1ZSAodjogYW55LCB0eXBlOiBzdHJpbmcpIHtcbiAgICAgIGlmICh0eXBlID09PSAnZmxvYXQnKSByZXR1cm4gTWF0aC5yb3VuZCh2ICogMTAwKSAvIDEwMFxuICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ludCcpIHJldHVybiBNYXRoLnJvdW5kKHYpXG4gICAgICBlbHNlIHJldHVybiAwXG4gICAgfSxcbiAgICBwYXJzZVZhbHVlICh2OiBzdHJpbmcsIHR5cGU6IHN0cmluZykge1xuICAgICAgaWYgKHR5cGUgPT09ICdmbG9hdCcpIHJldHVybiBwYXJzZUZsb2F0KHYpXG4gICAgICBlbHNlIGlmICh0eXBlID09PSAnaW50JykgcmV0dXJuIHBhcnNlSW50KHYsIDEwKSB8fCAwXG4gICAgICBlbHNlIHJldHVybiAwXG4gICAgfSxcbiAgICBjaGFuZ2VNb2RlICgpIHtcbiAgICAgIGNvbnN0IG1vZGVzID0gT2JqZWN0LmtleXModGhpcy5tb2RlcylcbiAgICAgIGNvbnN0IGluZGV4ID0gbW9kZXMuaW5kZXhPZih0aGlzLmludGVybmFsTW9kZSlcbiAgICAgIGNvbnN0IG5ld01vZGUgPSBtb2Rlc1soaW5kZXggKyAxKSAlIG1vZGVzLmxlbmd0aF1cbiAgICAgIHRoaXMuaW50ZXJuYWxNb2RlID0gbmV3TW9kZVxuICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOm1vZGUnLCBuZXdNb2RlKVxuICAgIH0sXG4gICAgZ2VuSW5wdXQgKHRhcmdldDogc3RyaW5nLCBhdHRyczogYW55LCB2YWx1ZTogYW55LCBvbjogYW55KTogVk5vZGUge1xuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWNvbG9yLXBpY2tlcl9faW5wdXQnLFxuICAgICAgfSwgW1xuICAgICAgICB0aGlzLiRjcmVhdGVFbGVtZW50KCdpbnB1dCcsIHtcbiAgICAgICAgICBrZXk6IHRhcmdldCxcbiAgICAgICAgICBhdHRycyxcbiAgICAgICAgICBkb21Qcm9wczoge1xuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbixcbiAgICAgICAgfSksXG4gICAgICAgIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB0YXJnZXQudG9VcHBlckNhc2UoKSksXG4gICAgICBdKVxuICAgIH0sXG4gICAgZ2VuSW5wdXRzICgpOiBWTm9kZVtdIHwgVk5vZGUge1xuICAgICAgc3dpdGNoICh0aGlzLmludGVybmFsTW9kZSkge1xuICAgICAgICBjYXNlICdoZXhhJzoge1xuICAgICAgICAgIGNvbnN0IGhleCA9IHRoaXMuY29sb3IuaGV4YVxuICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5oaWRlQWxwaGEgJiYgaGV4LmVuZHNXaXRoKCdGRicpID8gaGV4LnN1YnN0cigwLCA3KSA6IGhleFxuICAgICAgICAgIHJldHVybiB0aGlzLmdlbklucHV0KFxuICAgICAgICAgICAgJ2hleCcsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1heGxlbmd0aDogdGhpcy5oaWRlQWxwaGEgPyA3IDogOSxcbiAgICAgICAgICAgICAgZGlzYWJsZWQ6IHRoaXMuZGlzYWJsZWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGNoYW5nZTogKGU6IEV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZWwgPSBlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOmNvbG9yJywgdGhpcy5jdXJyZW50TW9kZS5mcm9tKHBhcnNlSGV4KGVsLnZhbHVlKSkpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICBjb25zdCBpbnB1dHMgPSB0aGlzLmhpZGVBbHBoYSA/IHRoaXMuY3VycmVudE1vZGUuaW5wdXRzIS5zbGljZSgwLCAtMSkgOiB0aGlzLmN1cnJlbnRNb2RlLmlucHV0cyFcbiAgICAgICAgICByZXR1cm4gaW5wdXRzLm1hcCgoW3RhcmdldCwgbWF4LCB0eXBlXSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmNvbG9yW3RoaXMuaW50ZXJuYWxNb2RlIGFzIGtleW9mIFZDb2xvclBpY2tlckNvbG9yXSBhcyBhbnlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbklucHV0KFxuICAgICAgICAgICAgICB0YXJnZXQsXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgbWF4LFxuICAgICAgICAgICAgICAgIHN0ZXA6IHR5cGUgPT09ICdmbG9hdCcgPyAnMC4wMScgOiB0eXBlID09PSAnaW50JyA/ICcxJyA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogdGhpcy5kaXNhYmxlZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdGhpcy5nZXRWYWx1ZSh2YWx1ZVt0YXJnZXRdLCB0eXBlKSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlucHV0OiAoZTogRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGVsID0gZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudFxuICAgICAgICAgICAgICAgICAgY29uc3QgbmV3VmFsID0gdGhpcy5wYXJzZVZhbHVlKGVsLnZhbHVlIHx8ICcwJywgdHlwZSlcblxuICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOmNvbG9yJywgdGhpcy5jdXJyZW50TW9kZS5mcm9tKFxuICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB2YWx1ZSwgeyBbdGFyZ2V0XTogbmV3VmFsIH0pLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbG9yLmFscGhhXG4gICAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBnZW5Td2l0Y2ggKCk6IFZOb2RlIHtcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZCdG4sIHtcbiAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICBzbWFsbDogdHJ1ZSxcbiAgICAgICAgICBpY29uOiB0cnVlLFxuICAgICAgICAgIGRpc2FibGVkOiB0aGlzLmRpc2FibGVkLFxuICAgICAgICB9LFxuICAgICAgICBvbjoge1xuICAgICAgICAgIGNsaWNrOiB0aGlzLmNoYW5nZU1vZGUsXG4gICAgICAgIH0sXG4gICAgICB9LCBbXG4gICAgICAgIHRoaXMuJGNyZWF0ZUVsZW1lbnQoVkljb24sICckdW5mb2xkJyksXG4gICAgICBdKVxuICAgIH0sXG4gIH0sXG5cbiAgcmVuZGVyIChoKTogVk5vZGUge1xuICAgIHJldHVybiBoKCdkaXYnLCB7XG4gICAgICBzdGF0aWNDbGFzczogJ3YtY29sb3ItcGlja2VyX19lZGl0JyxcbiAgICB9LCBbXG4gICAgICB0aGlzLmdlbklucHV0cygpLFxuICAgICAgIXRoaXMuaGlkZU1vZGVTd2l0Y2ggJiYgdGhpcy5nZW5Td2l0Y2goKSxcbiAgICBdKVxuICB9LFxufSlcbiJdfQ==