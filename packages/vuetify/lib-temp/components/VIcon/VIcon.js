import './VIcon.sass';
// Mixins
import BindsAttrs from '../../mixins/binds-attrs';
import Colorable from '../../mixins/colorable';
import Sizeable from '../../mixins/sizeable';
import Themeable from '../../mixins/themeable';
// Util
import { convertToUnit, keys, remapInternalIcon } from '../../util/helpers';
// Types
import Vue from 'vue';
import mixins from '../../util/mixins';
var SIZE_MAP;
(function (SIZE_MAP) {
    SIZE_MAP["xSmall"] = "12px";
    SIZE_MAP["small"] = "16px";
    SIZE_MAP["default"] = "24px";
    SIZE_MAP["medium"] = "28px";
    SIZE_MAP["large"] = "36px";
    SIZE_MAP["xLarge"] = "40px";
})(SIZE_MAP || (SIZE_MAP = {}));
function isFontAwesome5(iconType) {
    return ['fas', 'far', 'fal', 'fab', 'fad'].some(val => iconType.includes(val));
}
function isSvgPath(icon) {
    return (/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(icon) && /[\dz]$/i.test(icon) && icon.length > 4);
}
const VIcon = mixins(BindsAttrs, Colorable, Sizeable, Themeable
/* @vue/component */
).extend({
    name: 'v-icon',
    props: {
        dense: Boolean,
        disabled: Boolean,
        left: Boolean,
        right: Boolean,
        size: [Number, String],
        tag: {
            type: String,
            required: false,
            default: 'i',
        },
    },
    computed: {
        medium() {
            return false;
        },
        hasClickListener() {
            return Boolean(this.listeners$.click || this.listeners$['!click']);
        },
    },
    methods: {
        getIcon() {
            let iconName = '';
            if (this.$slots.default)
                iconName = this.$slots.default[0].text.trim();
            return remapInternalIcon(this, iconName);
        },
        getSize() {
            const sizes = {
                xSmall: this.xSmall,
                small: this.small,
                medium: this.medium,
                large: this.large,
                xLarge: this.xLarge,
            };
            const explicitSize = keys(sizes).find(key => sizes[key]);
            return ((explicitSize && SIZE_MAP[explicitSize]) || convertToUnit(this.size));
        },
        // Component data for both font and svg icon.
        getDefaultData() {
            const data = {
                staticClass: 'v-icon notranslate',
                class: {
                    'v-icon--disabled': this.disabled,
                    'v-icon--left': this.left,
                    'v-icon--link': this.hasClickListener,
                    'v-icon--right': this.right,
                    'v-icon--dense': this.dense,
                },
                attrs: {
                    'aria-hidden': !this.hasClickListener,
                    disabled: this.hasClickListener && this.disabled,
                    type: this.hasClickListener ? 'button' : undefined,
                    ...this.attrs$,
                },
                on: this.listeners$,
            };
            return data;
        },
        applyColors(data) {
            data.class = { ...data.class, ...this.themeClasses };
            this.setTextColor(this.color, data);
        },
        renderFontIcon(icon, h) {
            const newChildren = [];
            const data = this.getDefaultData();
            let iconType = 'material-icons';
            // Material Icon delimiter is _
            // https://material.io/icons/
            const delimiterIndex = icon.indexOf('-');
            const isMaterialIcon = delimiterIndex <= -1;
            if (isMaterialIcon) {
                // Material icon uses ligatures.
                newChildren.push(icon);
            }
            else {
                iconType = icon.slice(0, delimiterIndex);
                if (isFontAwesome5(iconType))
                    iconType = '';
            }
            data.class[iconType] = true;
            data.class[icon] = !isMaterialIcon;
            const fontSize = this.getSize();
            if (fontSize)
                data.style = { fontSize };
            this.applyColors(data);
            return h(this.hasClickListener ? 'button' : this.tag, data, newChildren);
        },
        renderSvgIcon(icon, h) {
            const fontSize = this.getSize();
            const wrapperData = {
                ...this.getDefaultData(),
                style: fontSize ? {
                    fontSize,
                    height: fontSize,
                    width: fontSize,
                } : undefined,
            };
            wrapperData.class['v-icon--svg'] = true;
            this.applyColors(wrapperData);
            const svgData = {
                attrs: {
                    xmlns: 'http://www.w3.org/2000/svg',
                    viewBox: '0 0 24 24',
                    height: fontSize || '24',
                    width: fontSize || '24',
                    role: 'img',
                    'aria-hidden': true,
                },
            };
            return h(this.hasClickListener ? 'button' : 'span', wrapperData, [
                h('svg', svgData, [
                    h('path', {
                        attrs: {
                            d: icon,
                        },
                    }),
                ]),
            ]);
        },
        renderSvgIconComponent(icon, h) {
            const data = this.getDefaultData();
            data.class['v-icon--is-component'] = true;
            const size = this.getSize();
            if (size) {
                data.style = {
                    fontSize: size,
                    height: size,
                    width: size,
                };
            }
            this.applyColors(data);
            const component = icon.component;
            data.props = icon.props;
            data.nativeOn = data.on;
            return h(component, data);
        },
    },
    render(h) {
        const icon = this.getIcon();
        if (typeof icon === 'string') {
            if (isSvgPath(icon)) {
                return this.renderSvgIcon(icon, h);
            }
            return this.renderFontIcon(icon, h);
        }
        return this.renderSvgIconComponent(icon, h);
    },
});
export default Vue.extend({
    name: 'v-icon',
    $_wrapperFor: VIcon,
    functional: true,
    render(h, { data, children }) {
        let iconName = '';
        // Support usage of v-text and v-html
        if (data.domProps) {
            iconName = data.domProps.textContent ||
                data.domProps.innerHTML ||
                iconName;
            // Remove nodes so it doesn't
            // overwrite our changes
            delete data.domProps.textContent;
            delete data.domProps.innerHTML;
        }
        return h(VIcon, data, iconName ? [iconName] : children);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkljb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WSWNvbi9WSWNvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGNBQWMsQ0FBQTtBQUVyQixTQUFTO0FBQ1QsT0FBTyxVQUFVLE1BQU0sMEJBQTBCLENBQUE7QUFDakQsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUE7QUFDOUMsT0FBTyxRQUFRLE1BQU0sdUJBQXVCLENBQUE7QUFDNUMsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUE7QUFFOUMsT0FBTztBQUNQLE9BQU8sRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFFM0UsUUFBUTtBQUNSLE9BQU8sR0FBdUQsTUFBTSxLQUFLLENBQUE7QUFDekUsT0FBTyxNQUFNLE1BQU0sbUJBQW1CLENBQUE7QUFHdEMsSUFBSyxRQU9KO0FBUEQsV0FBSyxRQUFRO0lBQ1gsMkJBQWUsQ0FBQTtJQUNmLDBCQUFjLENBQUE7SUFDZCw0QkFBZ0IsQ0FBQTtJQUNoQiwyQkFBZSxDQUFBO0lBQ2YsMEJBQWMsQ0FBQTtJQUNkLDJCQUFlLENBQUE7QUFDakIsQ0FBQyxFQVBJLFFBQVEsS0FBUixRQUFRLFFBT1o7QUFFRCxTQUFTLGNBQWMsQ0FBRSxRQUFnQjtJQUN2QyxPQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUNoRixDQUFDO0FBRUQsU0FBUyxTQUFTLENBQUUsSUFBWTtJQUM5QixPQUFPLENBQUMseUNBQXlDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFD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QyxNQUFNLENBQUM7SUFDeEIsSUFBSSxFQUFFLFFBQVE7SUFFZCxZQUFZLEVBQUUsS0FBSztJQUVuQixVQUFVLEVBQUUsSUFBSTtJQUVoQixNQUFNLENBQUUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtRQUMzQixJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUE7UUFFakIscUNBQXFDO1FBQ3JDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXO2dCQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVM7Z0JBQ3ZCLFFBQVEsQ0FBQTtZQUVWLDZCQUE2QjtZQUM3Qix3QkFBd0I7WUFDeEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQTtZQUNoQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFBO1NBQy9CO1FBRUQsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3pELENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJy4vVkljb24uc2FzcydcblxuLy8gTWl4aW5zXG5pbXBvcnQgQmluZHNBdHRycyBmcm9tICcuLi8uLi9taXhpbnMvYmluZHMtYXR0cnMnXG5pbXBvcnQgQ29sb3JhYmxlIGZyb20gJy4uLy4uL21peGlucy9jb2xvcmFibGUnXG5pbXBvcnQgU2l6ZWFibGUgZnJvbSAnLi4vLi4vbWl4aW5zL3NpemVhYmxlJ1xuaW1wb3J0IFRoZW1lYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvdGhlbWVhYmxlJ1xuXG4vLyBVdGlsXG5pbXBvcnQgeyBjb252ZXJ0VG9Vbml0LCBrZXlzLCByZW1hcEludGVybmFsSWNvbiB9IGZyb20gJy4uLy4uL3V0aWwvaGVscGVycydcblxuLy8gVHlwZXNcbmltcG9ydCBWdWUsIHsgQ3JlYXRlRWxlbWVudCwgVk5vZGUsIFZOb2RlQ2hpbGRyZW4sIFZOb2RlRGF0YSB9IGZyb20gJ3Z1ZSdcbmltcG9ydCBtaXhpbnMgZnJvbSAnLi4vLi4vdXRpbC9taXhpbnMnXG5pbXBvcnQgeyBWdWV0aWZ5SWNvbiwgVnVldGlmeUljb25Db21wb25lbnQgfSBmcm9tICd2dWV0aWZ5L3R5cGVzL3NlcnZpY2VzL2ljb25zJ1xuXG5lbnVtIFNJWkVfTUFQIHtcbiAgeFNtYWxsID0gJzEycHgnLFxuICBzbWFsbCA9ICcxNnB4JyxcbiAgZGVmYXVsdCA9ICcyNHB4JyxcbiAgbWVkaXVtID0gJzI4cHgnLFxuICBsYXJnZSA9ICczNnB4JyxcbiAgeExhcmdlID0gJzQwcHgnXG59XG5cbmZ1bmN0aW9uIGlzRm9udEF3ZXNvbWU1IChpY29uVHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBbJ2ZhcycsICdmYXInLCAnZmFsJywgJ2ZhYicsICdmYWQnXS5zb21lKHZhbCA9PiBpY29uVHlwZS5pbmNsdWRlcyh2YWwpKVxufVxuXG5mdW5jdGlvbiBpc1N2Z1BhdGggKGljb246IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gKC9eW216bGh2Y3NxdGFdXFxzKlstKy4wLTldW15tbGh2emNzcXRhXSsvaS50ZXN0KGljb24pICYmIC9bXFxkel0kL2kudGVzdChpY29uKSAmJiBpY29uLmxlbmd0aCA+IDQpXG59XG5cbmNvbnN0IFZJY29uID0gbWl4aW5zKFxuICBCaW5kc0F0dHJzLFxuICBDb2xvcmFibGUsXG4gIFNpemVhYmxlLFxuICBUaGVtZWFibGVcbiAgLyogQHZ1ZS9jb21wb25lbnQgKi9cbikuZXh0ZW5kKHtcbiAgbmFtZTogJ3YtaWNvbicsXG5cbiAgcHJvcHM6IHtcbiAgICBkZW5zZTogQm9vbGVhbixcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcbiAgICBsZWZ0OiBCb29sZWFuLFxuICAgIHJpZ2h0OiBCb29sZWFuLFxuICAgIHNpemU6IFtOdW1iZXIsIFN0cmluZ10sXG4gICAgdGFnOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICBkZWZhdWx0OiAnaScsXG4gICAgfSxcbiAgfSxcblxuICBjb21wdXRlZDoge1xuICAgIG1lZGl1bSAoKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9LFxuICAgIGhhc0NsaWNrTGlzdGVuZXIgKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIEJvb2xlYW4oXG4gICAgICAgIHRoaXMubGlzdGVuZXJzJC5jbGljayB8fCB0aGlzLmxpc3RlbmVycyRbJyFjbGljayddXG4gICAgICApXG4gICAgfSxcbiAgfSxcblxuICBtZXRob2RzOiB7XG4gICAgZ2V0SWNvbiAoKTogVnVldGlmeUljb24ge1xuICAgICAgbGV0IGljb25OYW1lID0gJydcbiAgICAgIGlmICh0aGlzLiRzbG90cy5kZWZhdWx0KSBpY29uTmFtZSA9IHRoaXMuJHNsb3RzLmRlZmF1bHRbMF0udGV4dCEudHJpbSgpXG5cbiAgICAgIHJldHVybiByZW1hcEludGVybmFsSWNvbih0aGlzLCBpY29uTmFtZSlcbiAgICB9LFxuICAgIGdldFNpemUgKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgICBjb25zdCBzaXplcyA9IHtcbiAgICAgICAgeFNtYWxsOiB0aGlzLnhTbWFsbCxcbiAgICAgICAgc21hbGw6IHRoaXMuc21hbGwsXG4gICAgICAgIG1lZGl1bTogdGhpcy5tZWRpdW0sXG4gICAgICAgIGxhcmdlOiB0aGlzLmxhcmdlLFxuICAgICAgICB4TGFyZ2U6IHRoaXMueExhcmdlLFxuICAgICAgfVxuXG4gICAgICBjb25zdCBleHBsaWNpdFNpemUgPSBrZXlzKHNpemVzKS5maW5kKGtleSA9PiBzaXplc1trZXldKVxuXG4gICAgICByZXR1cm4gKFxuICAgICAgICAoZXhwbGljaXRTaXplICYmIFNJWkVfTUFQW2V4cGxpY2l0U2l6ZV0pIHx8IGNvbnZlcnRUb1VuaXQodGhpcy5zaXplKVxuICAgICAgKVxuICAgIH0sXG4gICAgLy8gQ29tcG9uZW50IGRhdGEgZm9yIGJvdGggZm9udCBhbmQgc3ZnIGljb24uXG4gICAgZ2V0RGVmYXVsdERhdGEgKCk6IFZOb2RlRGF0YSB7XG4gICAgICBjb25zdCBkYXRhOiBWTm9kZURhdGEgPSB7XG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi1pY29uIG5vdHJhbnNsYXRlJyxcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1pY29uLS1kaXNhYmxlZCc6IHRoaXMuZGlzYWJsZWQsXG4gICAgICAgICAgJ3YtaWNvbi0tbGVmdCc6IHRoaXMubGVmdCxcbiAgICAgICAgICAndi1pY29uLS1saW5rJzogdGhpcy5oYXNDbGlja0xpc3RlbmVyLFxuICAgICAgICAgICd2LWljb24tLXJpZ2h0JzogdGhpcy5yaWdodCxcbiAgICAgICAgICAndi1pY29uLS1kZW5zZSc6IHRoaXMuZGVuc2UsXG4gICAgICAgIH0sXG4gICAgICAgIGF0dHJzOiB7XG4gICAgICAgICAgJ2FyaWEtaGlkZGVuJzogIXRoaXMuaGFzQ2xpY2tMaXN0ZW5lcixcbiAgICAgICAgICBkaXNhYmxlZDogdGhpcy5oYXNDbGlja0xpc3RlbmVyICYmIHRoaXMuZGlzYWJsZWQsXG4gICAgICAgICAgdHlwZTogdGhpcy5oYXNDbGlja0xpc3RlbmVyID8gJ2J1dHRvbicgOiB1bmRlZmluZWQsXG4gICAgICAgICAgLi4udGhpcy5hdHRycyQsXG4gICAgICAgIH0sXG4gICAgICAgIG9uOiB0aGlzLmxpc3RlbmVycyQsXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBkYXRhXG4gICAgfSxcbiAgICBhcHBseUNvbG9ycyAoZGF0YTogVk5vZGVEYXRhKTogdm9pZCB7XG4gICAgICBkYXRhLmNsYXNzID0geyAuLi5kYXRhLmNsYXNzLCAuLi50aGlzLnRoZW1lQ2xhc3NlcyB9XG4gICAgICB0aGlzLnNldFRleHRDb2xvcih0aGlzLmNvbG9yLCBkYXRhKVxuICAgIH0sXG4gICAgcmVuZGVyRm9udEljb24gKGljb246IHN0cmluZywgaDogQ3JlYXRlRWxlbWVudCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IG5ld0NoaWxkcmVuOiBWTm9kZUNoaWxkcmVuID0gW11cbiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldERlZmF1bHREYXRhKClcblxuICAgICAgbGV0IGljb25UeXBlID0gJ21hdGVyaWFsLWljb25zJ1xuICAgICAgLy8gTWF0ZXJpYWwgSWNvbiBkZWxpbWl0ZXIgaXMgX1xuICAgICAgLy8gaHR0cHM6Ly9tYXRlcmlhbC5pby9pY29ucy9cbiAgICAgIGNvbnN0IGRlbGltaXRlckluZGV4ID0gaWNvbi5pbmRleE9mKCctJylcbiAgICAgIGNvbnN0IGlzTWF0ZXJpYWxJY29uID0gZGVsaW1pdGVySW5kZXggPD0gLTFcblxuICAgICAgaWYgKGlzTWF0ZXJpYWxJY29uKSB7XG4gICAgICAgIC8vIE1hdGVyaWFsIGljb24gdXNlcyBsaWdhdHVyZXMuXG4gICAgICAgIG5ld0NoaWxkcmVuLnB1c2goaWNvbilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGljb25UeXBlID0gaWNvbi5zbGljZSgwLCBkZWxpbWl0ZXJJbmRleClcbiAgICAgICAgaWYgKGlzRm9udEF3ZXNvbWU1KGljb25UeXBlKSkgaWNvblR5cGUgPSAnJ1xuICAgICAgfVxuXG4gICAgICBkYXRhLmNsYXNzW2ljb25UeXBlXSA9IHRydWVcbiAgICAgIGRhdGEuY2xhc3NbaWNvbl0gPSAhaXNNYXRlcmlhbEljb25cblxuICAgICAgY29uc3QgZm9udFNpemUgPSB0aGlzLmdldFNpemUoKVxuICAgICAgaWYgKGZvbnRTaXplKSBkYXRhLnN0eWxlID0geyBmb250U2l6ZSB9XG5cbiAgICAgIHRoaXMuYXBwbHlDb2xvcnMoZGF0YSlcblxuICAgICAgcmV0dXJuIGgodGhpcy5oYXNDbGlja0xpc3RlbmVyID8gJ2J1dHRvbicgOiB0aGlzLnRhZywgZGF0YSwgbmV3Q2hpbGRyZW4pXG4gICAgfSxcbiAgICByZW5kZXJTdmdJY29uIChpY29uOiBzdHJpbmcsIGg6IENyZWF0ZUVsZW1lbnQpOiBWTm9kZSB7XG4gICAgICBjb25zdCBmb250U2l6ZSA9IHRoaXMuZ2V0U2l6ZSgpXG4gICAgICBjb25zdCB3cmFwcGVyRGF0YSA9IHtcbiAgICAgICAgLi4udGhpcy5nZXREZWZhdWx0RGF0YSgpLFxuICAgICAgICBzdHlsZTogZm9udFNpemUgPyB7XG4gICAgICAgICAgZm9udFNpemUsXG4gICAgICAgICAgaGVpZ2h0OiBmb250U2l6ZSxcbiAgICAgICAgICB3aWR0aDogZm9udFNpemUsXG4gICAgICAgIH0gOiB1bmRlZmluZWQsXG4gICAgICB9XG4gICAgICB3cmFwcGVyRGF0YS5jbGFzc1sndi1pY29uLS1zdmcnXSA9IHRydWVcbiAgICAgIHRoaXMuYXBwbHlDb2xvcnMod3JhcHBlckRhdGEpXG5cbiAgICAgIGNvbnN0IHN2Z0RhdGE6IFZOb2RlRGF0YSA9IHtcbiAgICAgICAgYXR0cnM6IHtcbiAgICAgICAgICB4bWxuczogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcbiAgICAgICAgICB2aWV3Qm94OiAnMCAwIDI0IDI0JyxcbiAgICAgICAgICBoZWlnaHQ6IGZvbnRTaXplIHx8ICcyNCcsXG4gICAgICAgICAgd2lkdGg6IGZvbnRTaXplIHx8ICcyNCcsXG4gICAgICAgICAgcm9sZTogJ2ltZycsXG4gICAgICAgICAgJ2FyaWEtaGlkZGVuJzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgodGhpcy5oYXNDbGlja0xpc3RlbmVyID8gJ2J1dHRvbicgOiAnc3BhbicsIHdyYXBwZXJEYXRhLCBbXG4gICAgICAgIGgoJ3N2ZycsIHN2Z0RhdGEsIFtcbiAgICAgICAgICBoKCdwYXRoJywge1xuICAgICAgICAgICAgYXR0cnM6IHtcbiAgICAgICAgICAgICAgZDogaWNvbixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pLFxuICAgICAgXSlcbiAgICB9LFxuICAgIHJlbmRlclN2Z0ljb25Db21wb25lbnQgKFxuICAgICAgaWNvbjogVnVldGlmeUljb25Db21wb25lbnQsXG4gICAgICBoOiBDcmVhdGVFbGVtZW50XG4gICAgKTogVk5vZGUge1xuICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0RGVmYXVsdERhdGEoKVxuICAgICAgZGF0YS5jbGFzc1sndi1pY29uLS1pcy1jb21wb25lbnQnXSA9IHRydWVcblxuICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMuZ2V0U2l6ZSgpXG4gICAgICBpZiAoc2l6ZSkge1xuICAgICAgICBkYXRhLnN0eWxlID0ge1xuICAgICAgICAgIGZvbnRTaXplOiBzaXplLFxuICAgICAgICAgIGhlaWdodDogc2l6ZSxcbiAgICAgICAgICB3aWR0aDogc2l6ZSxcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmFwcGx5Q29sb3JzKGRhdGEpXG5cbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGljb24uY29tcG9uZW50XG4gICAgICBkYXRhLnByb3BzID0gaWNvbi5wcm9wc1xuICAgICAgZGF0YS5uYXRpdmVPbiA9IGRhdGEub25cblxuICAgICAgcmV0dXJuIGgoY29tcG9uZW50LCBkYXRhKVxuICAgIH0sXG4gIH0sXG5cbiAgcmVuZGVyIChoOiBDcmVhdGVFbGVtZW50KTogVk5vZGUge1xuICAgIGNvbnN0IGljb24gPSB0aGlzLmdldEljb24oKVxuXG4gICAgaWYgKHR5cGVvZiBpY29uID09PSAnc3RyaW5nJykge1xuICAgICAgaWYgKGlzU3ZnUGF0aChpY29uKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJTdmdJY29uKGljb24sIGgpXG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJGb250SWNvbihpY29uLCBoKVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlbmRlclN2Z0ljb25Db21wb25lbnQoaWNvbiwgaClcbiAgfSxcbn0pXG5cbmV4cG9ydCBkZWZhdWx0IFZ1ZS5leHRlbmQoe1xuICBuYW1lOiAndi1pY29uJyxcblxuICAkX3dyYXBwZXJGb3I6IFZJY29uLFxuXG4gIGZ1bmN0aW9uYWw6IHRydWUsXG5cbiAgcmVuZGVyIChoLCB7IGRhdGEsIGNoaWxkcmVuIH0pOiBWTm9kZSB7XG4gICAgbGV0IGljb25OYW1lID0gJydcblxuICAgIC8vIFN1cHBvcnQgdXNhZ2Ugb2Ygdi10ZXh0IGFuZCB2LWh0bWxcbiAgICBpZiAoZGF0YS5kb21Qcm9wcykge1xuICAgICAgaWNvbk5hbWUgPSBkYXRhLmRvbVByb3BzLnRleHRDb250ZW50IHx8XG4gICAgICAgIGRhdGEuZG9tUHJvcHMuaW5uZXJIVE1MIHx8XG4gICAgICAgIGljb25OYW1lXG5cbiAgICAgIC8vIFJlbW92ZSBub2RlcyBzbyBpdCBkb2Vzbid0XG4gICAgICAvLyBvdmVyd3JpdGUgb3VyIGNoYW5nZXNcbiAgICAgIGRlbGV0ZSBkYXRhLmRvbVByb3BzLnRleHRDb250ZW50XG4gICAgICBkZWxldGUgZGF0YS5kb21Qcm9wcy5pbm5lckhUTUxcbiAgICB9XG5cbiAgICByZXR1cm4gaChWSWNvbiwgZGF0YSwgaWNvbk5hbWUgPyBbaWNvbk5hbWVdIDogY2hpbGRyZW4pXG4gIH0sXG59KVxuIl19