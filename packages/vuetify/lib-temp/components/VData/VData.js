// Helpers
import { wrapInArray, sortItems, deepEqual, groupItems, searchItems, fillArray } from '../../util/helpers';
import Vue from 'vue';
export default Vue.extend({
    name: 'v-data',
    inheritAttrs: false,
    props: {
        items: {
            type: Array,
            default: () => [],
        },
        options: {
            type: Object,
            default: () => ({}),
        },
        sortBy: {
            type: [String, Array],
            default: () => [],
        },
        sortDesc: {
            type: [Boolean, Array],
            default: () => [],
        },
        customSort: {
            type: Function,
            default: sortItems,
        },
        mustSort: Boolean,
        multiSort: Boolean,
        page: {
            type: Number,
            default: 1,
        },
        itemsPerPage: {
            type: Number,
            default: 10,
        },
        groupBy: {
            type: [String, Array],
            default: () => [],
        },
        groupDesc: {
            type: [Boolean, Array],
            default: () => [],
        },
        customGroup: {
            type: Function,
            default: groupItems,
        },
        locale: {
            type: String,
            default: 'en-US',
        },
        disableSort: Boolean,
        disablePagination: Boolean,
        disableFiltering: Boolean,
        search: String,
        customFilter: {
            type: Function,
            default: searchItems,
        },
        serverItemsLength: {
            type: Number,
            default: -1,
        },
    },
    data() {
        let internalOptions = {
            page: this.page,
            itemsPerPage: this.itemsPerPage,
            sortBy: wrapInArray(this.sortBy),
            sortDesc: wrapInArray(this.sortDesc),
            groupBy: wrapInArray(this.groupBy),
            groupDesc: wrapInArray(this.groupDesc),
            mustSort: this.mustSort,
            multiSort: this.multiSort,
        };
        if (this.options) {
            internalOptions = Object.assign(internalOptions, this.options);
        }
        const { sortBy, sortDesc, groupBy, groupDesc } = internalOptions;
        const sortDiff = sortBy.length - sortDesc.length;
        const groupDiff = groupBy.length - groupDesc.length;
        if (sortDiff > 0) {
            internalOptions.sortDesc.push(...fillArray(sortDiff, false));
        }
        if (groupDiff > 0) {
            internalOptions.groupDesc.push(...fillArray(groupDiff, false));
        }
        return {
            internalOptions,
        };
    },
    computed: {
        itemsLength() {
            return this.serverItemsLength >= 0 ? this.serverItemsLength : this.filteredItems.length;
        },
        pageCount() {
            return this.internalOptions.itemsPerPage <= 0
                ? 1
                : Math.ceil(this.itemsLength / this.internalOptions.itemsPerPage);
        },
        pageStart() {
            if (this.internalOptions.itemsPerPage === -1 || !this.items.length)
                return 0;
            return (this.internalOptions.page - 1) * this.internalOptions.itemsPerPage;
        },
        pageStop() {
            if (this.internalOptions.itemsPerPage === -1)
                return this.itemsLength;
            if (!this.items.length)
                return 0;
            return Math.min(this.itemsLength, this.internalOptions.page * this.internalOptions.itemsPerPage);
        },
        isGrouped() {
            return !!this.internalOptions.groupBy.length;
        },
        pagination() {
            return {
                page: this.internalOptions.page,
                itemsPerPage: this.internalOptions.itemsPerPage,
                pageStart: this.pageStart,
                pageStop: this.pageStop,
                pageCount: this.pageCount,
                itemsLength: this.itemsLength,
            };
        },
        filteredItems() {
            let items = this.items.slice();
            if (!this.disableFiltering && this.serverItemsLength <= 0) {
                items = this.customFilter(items, this.search);
            }
            return items;
        },
        computedItems() {
            let items = this.filteredItems.slice();
            if (!this.disableSort && this.serverItemsLength <= 0) {
                items = this.sortItems(items);
            }
            if (!this.disablePagination && this.serverItemsLength <= 0) {
                items = this.paginateItems(items);
            }
            return items;
        },
        groupedItems() {
            return this.isGrouped ? this.groupItems(this.computedItems) : null;
        },
        scopedProps() {
            const props = {
                sort: this.sort,
                sortArray: this.sortArray,
                group: this.group,
                items: this.computedItems,
                options: this.internalOptions,
                updateOptions: this.updateOptions,
                pagination: this.pagination,
                groupedItems: this.groupedItems,
                originalItemsLength: this.items.length,
            };
            return props;
        },
        computedOptions() {
            return { ...this.options };
        },
    },
    watch: {
        computedOptions: {
            handler(options, old) {
                if (deepEqual(options, old))
                    return;
                this.updateOptions(options);
            },
            deep: true,
            immediate: true,
        },
        internalOptions: {
            handler(options, old) {
                if (deepEqual(options, old))
                    return;
                this.$emit('update:options', options);
            },
            deep: true,
            immediate: true,
        },
        page(page) {
            this.updateOptions({ page });
        },
        'internalOptions.page'(page) {
            this.$emit('update:page', page);
        },
        itemsPerPage(itemsPerPage) {
            this.updateOptions({ itemsPerPage });
        },
        'internalOptions.itemsPerPage'(itemsPerPage) {
            this.$emit('update:items-per-page', itemsPerPage);
        },
        sortBy(sortBy) {
            this.updateOptions({ sortBy: wrapInArray(sortBy) });
        },
        'internalOptions.sortBy'(sortBy, old) {
            !deepEqual(sortBy, old) && this.$emit('update:sort-by', Array.isArray(this.sortBy) ? sortBy : sortBy[0]);
        },
        sortDesc(sortDesc) {
            this.updateOptions({ sortDesc: wrapInArray(sortDesc) });
        },
        'internalOptions.sortDesc'(sortDesc, old) {
            !deepEqual(sortDesc, old) && this.$emit('update:sort-desc', Array.isArray(this.sortDesc) ? sortDesc : sortDesc[0]);
        },
        groupBy(groupBy) {
            this.updateOptions({ groupBy: wrapInArray(groupBy) });
        },
        'internalOptions.groupBy'(groupBy, old) {
            !deepEqual(groupBy, old) && this.$emit('update:group-by', Array.isArray(this.groupBy) ? groupBy : groupBy[0]);
        },
        groupDesc(groupDesc) {
            this.updateOptions({ groupDesc: wrapInArray(groupDesc) });
        },
        'internalOptions.groupDesc'(groupDesc, old) {
            !deepEqual(groupDesc, old) && this.$emit('update:group-desc', Array.isArray(this.groupDesc) ? groupDesc : groupDesc[0]);
        },
        multiSort(multiSort) {
            this.updateOptions({ multiSort });
        },
        'internalOptions.multiSort'(multiSort) {
            this.$emit('update:multi-sort', multiSort);
        },
        mustSort(mustSort) {
            this.updateOptions({ mustSort });
        },
        'internalOptions.mustSort'(mustSort) {
            this.$emit('update:must-sort', mustSort);
        },
        pageCount: {
            handler(pageCount) {
                this.$emit('page-count', pageCount);
            },
            immediate: true,
        },
        computedItems: {
            handler(computedItems) {
                this.$emit('current-items', computedItems);
            },
            immediate: true,
        },
        pagination: {
            handler(pagination, old) {
                if (deepEqual(pagination, old))
                    return;
                this.$emit('pagination', this.pagination);
            },
            immediate: true,
        },
    },
    methods: {
        toggle(key, oldBy, oldDesc, page, mustSort, multiSort) {
            let by = oldBy.slice();
            let desc = oldDesc.slice();
            const byIndex = by.findIndex((k) => k === key);
            if (byIndex < 0) {
                if (!multiSort) {
                    by = [];
                    desc = [];
                }
                by.push(key);
                desc.push(false);
            }
            else if (byIndex >= 0 && !desc[byIndex]) {
                desc[byIndex] = true;
            }
            else if (!mustSort) {
                by.splice(byIndex, 1);
                desc.splice(byIndex, 1);
            }
            else {
                desc[byIndex] = false;
            }
            // Reset page to 1 if sortBy or sortDesc have changed
            if (!deepEqual(by, oldBy) || !deepEqual(desc, oldDesc)) {
                page = 1;
            }
            return { by, desc, page };
        },
        group(key) {
            const { by: groupBy, desc: groupDesc, page } = this.toggle(key, this.internalOptions.groupBy, this.internalOptions.groupDesc, this.internalOptions.page, true, false);
            this.updateOptions({ groupBy, groupDesc, page });
        },
        sort(key) {
            if (Array.isArray(key))
                return this.sortArray(key);
            const { by: sortBy, desc: sortDesc, page } = this.toggle(key, this.internalOptions.sortBy, this.internalOptions.sortDesc, this.internalOptions.page, this.internalOptions.mustSort, this.internalOptions.multiSort);
            this.updateOptions({ sortBy, sortDesc, page });
        },
        sortArray(sortBy) {
            const sortDesc = sortBy.map(s => {
                const i = this.internalOptions.sortBy.findIndex((k) => k === s);
                return i > -1 ? this.internalOptions.sortDesc[i] : false;
            });
            this.updateOptions({ sortBy, sortDesc });
        },
        updateOptions(options) {
            this.internalOptions = {
                ...this.internalOptions,
                ...options,
                page: this.serverItemsLength < 0
                    ? Math.max(1, Math.min(options.page || this.internalOptions.page, this.pageCount))
                    : options.page || this.internalOptions.page,
            };
        },
        sortItems(items) {
            let sortBy = this.internalOptions.sortBy;
            let sortDesc = this.internalOptions.sortDesc;
            if (this.internalOptions.groupBy.length) {
                sortBy = [...this.internalOptions.groupBy, ...sortBy];
                sortDesc = [...this.internalOptions.groupDesc, ...sortDesc];
            }
            return this.customSort(items, sortBy, sortDesc, this.locale);
        },
        groupItems(items) {
            return this.customGroup(items, this.internalOptions.groupBy, this.internalOptions.groupDesc);
        },
        paginateItems(items) {
            // Make sure we don't try to display non-existant page if items suddenly change
            // TODO: Could possibly move this to pageStart/pageStop?
            if (this.serverItemsLength === -1 && items.length <= this.pageStart) {
                this.internalOptions.page = Math.max(1, this.internalOptions.page - 1);
            }
            return items.slice(this.pageStart, this.pageStop);
        },
    },
    render() {
        return this.$scopedSlots.default && this.$scopedSlots.default(this.scopedProps);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0YS9WRGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxVQUFVO0FBQ1YsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDMUcsT0FBTyxHQUFjLE1BQU0sS0FBSyxDQUFBO0FBY2hDLGVBQWUsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUN4QixJQUFJLEVBQUUsUUFBUTtJQUVkLFlBQVksRUFBRSxLQUFLO0lBRW5CLEtBQUssRUFBRTtRQUNMLEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxLQUF3QjtZQUM5QixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtTQUNsQjtRQUNELE9BQU8sRUFBRTtZQUNQLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQ21CO1FBQ3hDLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQWdDO1lBQ3BELE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFO1NBQ2xCO1FBQ0QsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBa0M7WUFDdkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUU7U0FDbEI7UUFDRCxVQUFVLEVBQUU7WUFDVixJQUFJLEVBQUUsUUFBc0M7WUFDNUMsT0FBTyxFQUFFLFNBQVM7U0FDbkI7UUFDRCxRQUFRLEVBQUUsT0FBTztRQUNqQixTQUFTLEVBQUUsT0FBTztRQUNsQixJQUFJLEVBQUU7WUFDSixJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFDRCxZQUFZLEVBQUU7WUFDWixJQUFJLEVBQUUs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O2dCQUNuRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQTthQUN2RTtZQUVELE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUNuRCxDQUFDO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFRLENBQUE7SUFDeEYsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIEhlbHBlcnNcbmltcG9ydCB7IHdyYXBJbkFycmF5LCBzb3J0SXRlbXMsIGRlZXBFcXVhbCwgZ3JvdXBJdGVtcywgc2VhcmNoSXRlbXMsIGZpbGxBcnJheSB9IGZyb20gJy4uLy4uL3V0aWwvaGVscGVycydcbmltcG9ydCBWdWUsIHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbi8vIFR5cGVzXG5pbXBvcnQge1xuICBEYXRhT3B0aW9ucyxcbiAgRGF0YVBhZ2luYXRpb24sXG4gIERhdGFTY29wZVByb3BzLFxuICBEYXRhU29ydEZ1bmN0aW9uLFxuICBEYXRhR3JvdXBGdW5jdGlvbixcbiAgRGF0YVNlYXJjaEZ1bmN0aW9uLFxuICBJdGVtR3JvdXAsXG59IGZyb20gJ3Z1ZXRpZnkvdHlwZXMnXG5pbXBvcnQgeyBQcm9wVmFsaWRhdG9yLCBQcm9wVHlwZSB9IGZyb20gJ3Z1ZS90eXBlcy9vcHRpb25zJ1xuXG5leHBvcnQgZGVmYXVsdCBWdWUuZXh0ZW5kKHtcbiAgbmFtZTogJ3YtZGF0YScsXG5cbiAgaW5oZXJpdEF0dHJzOiBmYWxzZSxcblxuICBwcm9wczoge1xuICAgIGl0ZW1zOiB7XG4gICAgICB0eXBlOiBBcnJheSBhcyBQcm9wVHlwZTxhbnlbXT4sXG4gICAgICBkZWZhdWx0OiAoKSA9PiBbXSxcbiAgICB9LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIHR5cGU6IE9iamVjdCxcbiAgICAgIGRlZmF1bHQ6ICgpID0+ICh7fSksXG4gICAgfSBhcyBQcm9wVmFsaWRhdG9yPFBhcnRpYWw8RGF0YU9wdGlvbnM+PixcbiAgICBzb3J0Qnk6IHtcbiAgICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5XSBhcyBQcm9wVHlwZTxzdHJpbmcgfCBzdHJpbmdbXT4sXG4gICAgICBkZWZhdWx0OiAoKSA9PiBbXSxcbiAgICB9LFxuICAgIHNvcnREZXNjOiB7XG4gICAgICB0eXBlOiBbQm9vbGVhbiwgQXJyYXldIGFzIFByb3BUeXBlPGJvb2xlYW4gfCBib29sZWFuW10+LFxuICAgICAgZGVmYXVsdDogKCkgPT4gW10sXG4gICAgfSxcbiAgICBjdXN0b21Tb3J0OiB7XG4gICAgICB0eXBlOiBGdW5jdGlvbiBhcyBQcm9wVHlwZTxEYXRhU29ydEZ1bmN0aW9uPixcbiAgICAgIGRlZmF1bHQ6IHNvcnRJdGVtcyxcbiAgICB9LFxuICAgIG11c3RTb3J0OiBCb29sZWFuLFxuICAgIG11bHRpU29ydDogQm9vbGVhbixcbiAgICBwYWdlOiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICBkZWZhdWx0OiAxLFxuICAgIH0sXG4gICAgaXRlbXNQZXJQYWdlOiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICBkZWZhdWx0OiAxMCxcbiAgICB9LFxuICAgIGdyb3VwQnk6IHtcbiAgICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5XSBhcyBQcm9wVHlwZTxzdHJpbmcgfCBzdHJpbmdbXT4sXG4gICAgICBkZWZhdWx0OiAoKSA9PiBbXSxcbiAgICB9LFxuICAgIGdyb3VwRGVzYzoge1xuICAgICAgdHlwZTogW0Jvb2xlYW4sIEFycmF5XSBhcyBQcm9wVHlwZTxib29sZWFuIHwgYm9vbGVhbltdPixcbiAgICAgIGRlZmF1bHQ6ICgpID0+IFtdLFxuICAgIH0sXG4gICAgY3VzdG9tR3JvdXA6IHtcbiAgICAgIHR5cGU6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPERhdGFHcm91cEZ1bmN0aW9uPixcbiAgICAgIGRlZmF1bHQ6IGdyb3VwSXRlbXMsXG4gICAgfSxcbiAgICBsb2NhbGU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdlbi1VUycsXG4gICAgfSxcbiAgICBkaXNhYmxlU29ydDogQm9vbGVhbixcbiAgICBkaXNhYmxlUGFnaW5hdGlvbjogQm9vbGVhbixcbiAgICBkaXNhYmxlRmlsdGVyaW5nOiBCb29sZWFuLFxuICAgIHNlYXJjaDogU3RyaW5nLFxuICAgIGN1c3RvbUZpbHRlcjoge1xuICAgICAgdHlwZTogRnVuY3Rpb24gYXMgUHJvcFR5cGU8RGF0YVNlYXJjaEZ1bmN0aW9uPixcbiAgICAgIGRlZmF1bHQ6IHNlYXJjaEl0ZW1zLFxuICAgIH0sXG4gICAgc2VydmVySXRlbXNMZW5ndGg6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIGRlZmF1bHQ6IC0xLFxuICAgIH0sXG4gIH0sXG5cbiAgZGF0YSAoKSB7XG4gICAgbGV0IGludGVybmFsT3B0aW9uczogRGF0YU9wdGlvbnMgPSB7XG4gICAgICBwYWdlOiB0aGlzLnBhZ2UsXG4gICAgICBpdGVtc1BlclBhZ2U6IHRoaXMuaXRlbXNQZXJQYWdlLFxuICAgICAgc29ydEJ5OiB3cmFwSW5BcnJheSh0aGlzLnNvcnRCeSksXG4gICAgICBzb3J0RGVzYzogd3JhcEluQXJyYXkodGhpcy5zb3J0RGVzYyksXG4gICAgICBncm91cEJ5OiB3cmFwSW5BcnJheSh0aGlzLmdyb3VwQnkpLFxuICAgICAgZ3JvdXBEZXNjOiB3cmFwSW5BcnJheSh0aGlzLmdyb3VwRGVzYyksXG4gICAgICBtdXN0U29ydDogdGhpcy5tdXN0U29ydCxcbiAgICAgIG11bHRpU29ydDogdGhpcy5tdWx0aVNvcnQsXG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3B0aW9ucykge1xuICAgICAgaW50ZXJuYWxPcHRpb25zID0gT2JqZWN0LmFzc2lnbihpbnRlcm5hbE9wdGlvbnMsIHRoaXMub3B0aW9ucylcbiAgICB9XG5cbiAgICBjb25zdCB7IHNvcnRCeSwgc29ydERlc2MsIGdyb3VwQnksIGdyb3VwRGVzYyB9ID0gaW50ZXJuYWxPcHRpb25zXG4gICAgY29uc3Qgc29ydERpZmYgPSBzb3J0QnkubGVuZ3RoIC0gc29ydERlc2MubGVuZ3RoXG4gICAgY29uc3QgZ3JvdXBEaWZmID0gZ3JvdXBCeS5sZW5ndGggLSBncm91cERlc2MubGVuZ3RoXG5cbiAgICBpZiAoc29ydERpZmYgPiAwKSB7XG4gICAgICBpbnRlcm5hbE9wdGlvbnMuc29ydERlc2MucHVzaCguLi5maWxsQXJyYXkoc29ydERpZmYsIGZhbHNlKSlcbiAgICB9XG5cbiAgICBpZiAoZ3JvdXBEaWZmID4gMCkge1xuICAgICAgaW50ZXJuYWxPcHRpb25zLmdyb3VwRGVzYy5wdXNoKC4uLmZpbGxBcnJheShncm91cERpZmYsIGZhbHNlKSlcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaW50ZXJuYWxPcHRpb25zLFxuICAgIH1cbiAgfSxcblxuICBjb21wdXRlZDoge1xuICAgIGl0ZW1zTGVuZ3RoICgpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIHRoaXMuc2VydmVySXRlbXNMZW5ndGggPj0gMCA/IHRoaXMuc2VydmVySXRlbXNMZW5ndGggOiB0aGlzLmZpbHRlcmVkSXRlbXMubGVuZ3RoXG4gICAgfSxcbiAgICBwYWdlQ291bnQgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5pbnRlcm5hbE9wdGlvbnMuaXRlbXNQZXJQYWdlIDw9IDBcbiAgICAgICAgPyAxXG4gICAgICAgIDogTWF0aC5jZWlsKHRoaXMuaXRlbXNMZW5ndGggLyB0aGlzLmludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2UpXG4gICAgfSxcbiAgICBwYWdlU3RhcnQgKCk6IG51bWJlciB7XG4gICAgICBpZiAodGhpcy5pbnRlcm5hbE9wdGlvbnMuaXRlbXNQZXJQYWdlID09PSAtMSB8fCAhdGhpcy5pdGVtcy5sZW5ndGgpIHJldHVybiAwXG5cbiAgICAgIHJldHVybiAodGhpcy5pbnRlcm5hbE9wdGlvbnMucGFnZSAtIDEpICogdGhpcy5pbnRlcm5hbE9wdGlvbnMuaXRlbXNQZXJQYWdlXG4gICAgfSxcbiAgICBwYWdlU3RvcCAoKTogbnVtYmVyIHtcbiAgICAgIGlmICh0aGlzLmludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2UgPT09IC0xKSByZXR1cm4gdGhpcy5pdGVtc0xlbmd0aFxuICAgICAgaWYgKCF0aGlzLml0ZW1zLmxlbmd0aCkgcmV0dXJuIDBcblxuICAgICAgcmV0dXJuIE1hdGgubWluKHRoaXMuaXRlbXNMZW5ndGgsIHRoaXMuaW50ZXJuYWxPcHRpb25zLnBhZ2UgKiB0aGlzLmludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2UpXG4gICAgfSxcbiAgICBpc0dyb3VwZWQgKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuICEhdGhpcy5pbnRlcm5hbE9wdGlvbnMuZ3JvdXBCeS5sZW5ndGhcbiAgICB9LFxuICAgIHBhZ2luYXRpb24gKCk6IERhdGFQYWdpbmF0aW9uIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhZ2U6IHRoaXMuaW50ZXJuYWxPcHRpb25zLnBhZ2UsXG4gICAgICAgIGl0ZW1zUGVyUGFnZTogdGhpcy5pbnRlcm5hbE9wdGlvbnMuaXRlbXNQZXJQYWdlLFxuICAgICAgICBwYWdlU3RhcnQ6IHRoaXMucGFnZVN0YXJ0LFxuICAgICAgICBwYWdlU3RvcDogdGhpcy5wYWdlU3RvcCxcbiAgICAgICAgcGFnZUNvdW50OiB0aGlzLnBhZ2VDb3VudCxcbiAgICAgICAgaXRlbXNMZW5ndGg6IHRoaXMuaXRlbXNMZW5ndGgsXG4gICAgICB9XG4gICAgfSxcbiAgICBmaWx0ZXJlZEl0ZW1zICgpOiBhbnlbXSB7XG4gICAgICBsZXQgaXRlbXMgPSB0aGlzLml0ZW1zLnNsaWNlKClcblxuICAgICAgaWYgKCF0aGlzLmRpc2FibGVGaWx0ZXJpbmcgJiYgdGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA8PSAwKSB7XG4gICAgICAgIGl0ZW1zID0gdGhpcy5jdXN0b21GaWx0ZXIoaXRlbXMsIHRoaXMuc2VhcmNoKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gaXRlbXNcbiAgICB9LFxuICAgIGNvbXB1dGVkSXRlbXMgKCk6IGFueVtdIHtcbiAgICAgIGxldCBpdGVtcyA9IHRoaXMuZmlsdGVyZWRJdGVtcy5zbGljZSgpXG5cbiAgICAgIGlmICghdGhpcy5kaXNhYmxlU29ydCAmJiB0aGlzLnNlcnZlckl0ZW1zTGVuZ3RoIDw9IDApIHtcbiAgICAgICAgaXRlbXMgPSB0aGlzLnNvcnRJdGVtcyhpdGVtcylcbiAgICAgIH1cblxuICAgICAgaWYgKCF0aGlzLmRpc2FibGVQYWdpbmF0aW9uICYmIHRoaXMuc2VydmVySXRlbXNMZW5ndGggPD0gMCkge1xuICAgICAgICBpdGVtcyA9IHRoaXMucGFnaW5hdGVJdGVtcyhpdGVtcylcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGl0ZW1zXG4gICAgfSxcbiAgICBncm91cGVkSXRlbXMgKCk6IEl0ZW1Hcm91cDxhbnk+W10gfCBudWxsIHtcbiAgICAgIHJldHVybiB0aGlzLmlzR3JvdXBlZCA/IHRoaXMuZ3JvdXBJdGVtcyh0aGlzLmNvbXB1dGVkSXRlbXMpIDogbnVsbFxuICAgIH0sXG4gICAgc2NvcGVkUHJvcHMgKCk6IERhdGFTY29wZVByb3BzIHtcbiAgICAgIGNvbnN0IHByb3BzID0ge1xuICAgICAgICBzb3J0OiB0aGlzLnNvcnQsXG4gICAgICAgIHNvcnRBcnJheTogdGhpcy5zb3J0QXJyYXksXG4gICAgICAgIGdyb3VwOiB0aGlzLmdyb3VwLFxuICAgICAgICBpdGVtczogdGhpcy5jb21wdXRlZEl0ZW1zLFxuICAgICAgICBvcHRpb25zOiB0aGlzLmludGVybmFsT3B0aW9ucyxcbiAgICAgICAgdXBkYXRlT3B0aW9uczogdGhpcy51cGRhdGVPcHRpb25zLFxuICAgICAgICBwYWdpbmF0aW9uOiB0aGlzLnBhZ2luYXRpb24sXG4gICAgICAgIGdyb3VwZWRJdGVtczogdGhpcy5ncm91cGVkSXRlbXMsXG4gICAgICAgIG9yaWdpbmFsSXRlbXNMZW5ndGg6IHRoaXMuaXRlbXMubGVuZ3RoLFxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJvcHNcbiAgICB9LFxuICAgIGNvbXB1dGVkT3B0aW9ucyAoKTogRGF0YU9wdGlvbnMge1xuICAgICAgcmV0dXJuIHsgLi4udGhpcy5vcHRpb25zIH0gYXMgRGF0YU9wdGlvbnNcbiAgICB9LFxuICB9LFxuXG4gIHdhdGNoOiB7XG4gICAgY29tcHV0ZWRPcHRpb25zOiB7XG4gICAgICBoYW5kbGVyIChvcHRpb25zOiBEYXRhT3B0aW9ucywgb2xkOiBEYXRhT3B0aW9ucykge1xuICAgICAgICBpZiAoZGVlcEVxdWFsKG9wdGlvbnMsIG9sZCkpIHJldHVyblxuXG4gICAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyhvcHRpb25zKVxuICAgICAgfSxcbiAgICAgIGRlZXA6IHRydWUsXG4gICAgICBpbW1lZGlhdGU6IHRydWUsXG4gICAgfSxcbiAgICBpbnRlcm5hbE9wdGlvbnM6IHtcbiAgICAgIGhhbmRsZXIgKG9wdGlvbnM6IERhdGFPcHRpb25zLCBvbGQ6IERhdGFPcHRpb25zKSB7XG4gICAgICAgIGlmIChkZWVwRXF1YWwob3B0aW9ucywgb2xkKSkgcmV0dXJuXG4gICAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZTpvcHRpb25zJywgb3B0aW9ucylcbiAgICAgIH0sXG4gICAgICBkZWVwOiB0cnVlLFxuICAgICAgaW1tZWRpYXRlOiB0cnVlLFxuICAgIH0sXG4gICAgcGFnZSAocGFnZTogbnVtYmVyKSB7XG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBwYWdlIH0pXG4gICAgfSxcbiAgICAnaW50ZXJuYWxPcHRpb25zLnBhZ2UnIChwYWdlOiBudW1iZXIpIHtcbiAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZTpwYWdlJywgcGFnZSlcbiAgICB9LFxuICAgIGl0ZW1zUGVyUGFnZSAoaXRlbXNQZXJQYWdlOiBudW1iZXIpIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IGl0ZW1zUGVyUGFnZSB9KVxuICAgIH0sXG4gICAgJ2ludGVybmFsT3B0aW9ucy5pdGVtc1BlclBhZ2UnIChpdGVtc1BlclBhZ2U6IG51bWJlcikge1xuICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOml0ZW1zLXBlci1wYWdlJywgaXRlbXNQZXJQYWdlKVxuICAgIH0sXG4gICAgc29ydEJ5IChzb3J0Qnk6IHN0cmluZyB8IHN0cmluZ1tdKSB7XG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBzb3J0Qnk6IHdyYXBJbkFycmF5KHNvcnRCeSkgfSlcbiAgICB9LFxuICAgICdpbnRlcm5hbE9wdGlvbnMuc29ydEJ5JyAoc29ydEJ5OiBzdHJpbmdbXSwgb2xkOiBzdHJpbmdbXSkge1xuICAgICAgIWRlZXBFcXVhbChzb3J0QnksIG9sZCkgJiYgdGhpcy4kZW1pdCgndXBkYXRlOnNvcnQtYnknLCBBcnJheS5pc0FycmF5KHRoaXMuc29ydEJ5KSA/IHNvcnRCeSA6IHNvcnRCeVswXSlcbiAgICB9LFxuICAgIHNvcnREZXNjIChzb3J0RGVzYzogYm9vbGVhbiB8IGJvb2xlYW5bXSkge1xuICAgICAgdGhpcy51cGRhdGVPcHRpb25zKHsgc29ydERlc2M6IHdyYXBJbkFycmF5KHNvcnREZXNjKSB9KVxuICAgIH0sXG4gICAgJ2ludGVybmFsT3B0aW9ucy5zb3J0RGVzYycgKHNvcnREZXNjOiBib29sZWFuW10sIG9sZDogYm9vbGVhbltdKSB7XG4gICAgICAhZGVlcEVxdWFsKHNvcnREZXNjLCBvbGQpICYmIHRoaXMuJGVtaXQoJ3VwZGF0ZTpzb3J0LWRlc2MnLCBBcnJheS5pc0FycmF5KHRoaXMuc29ydERlc2MpID8gc29ydERlc2MgOiBzb3J0RGVzY1swXSlcbiAgICB9LFxuICAgIGdyb3VwQnkgKGdyb3VwQnk6IHN0cmluZyB8IHN0cmluZ1tdKSB7XG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBncm91cEJ5OiB3cmFwSW5BcnJheShncm91cEJ5KSB9KVxuICAgIH0sXG4gICAgJ2ludGVybmFsT3B0aW9ucy5ncm91cEJ5JyAoZ3JvdXBCeTogc3RyaW5nW10sIG9sZDogc3RyaW5nW10pIHtcbiAgICAgICFkZWVwRXF1YWwoZ3JvdXBCeSwgb2xkKSAmJiB0aGlzLiRlbWl0KCd1cGRhdGU6Z3JvdXAtYnknLCBBcnJheS5pc0FycmF5KHRoaXMuZ3JvdXBCeSkgPyBncm91cEJ5IDogZ3JvdXBCeVswXSlcbiAgICB9LFxuICAgIGdyb3VwRGVzYyAoZ3JvdXBEZXNjOiBib29sZWFuIHwgYm9vbGVhbltdKSB7XG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBncm91cERlc2M6IHdyYXBJbkFycmF5KGdyb3VwRGVzYykgfSlcbiAgICB9LFxuICAgICdpbnRlcm5hbE9wdGlvbnMuZ3JvdXBEZXNjJyAoZ3JvdXBEZXNjOiBib29sZWFuW10sIG9sZDogYm9vbGVhbltdKSB7XG4gICAgICAhZGVlcEVxdWFsKGdyb3VwRGVzYywgb2xkKSAmJiB0aGlzLiRlbWl0KCd1cGRhdGU6Z3JvdXAtZGVzYycsIEFycmF5LmlzQXJyYXkodGhpcy5ncm91cERlc2MpID8gZ3JvdXBEZXNjIDogZ3JvdXBEZXNjWzBdKVxuICAgIH0sXG4gICAgbXVsdGlTb3J0IChtdWx0aVNvcnQ6IGJvb2xlYW4pIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IG11bHRpU29ydCB9KVxuICAgIH0sXG4gICAgJ2ludGVybmFsT3B0aW9ucy5tdWx0aVNvcnQnIChtdWx0aVNvcnQ6IGJvb2xlYW4pIHtcbiAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZTptdWx0aS1zb3J0JywgbXVsdGlTb3J0KVxuICAgIH0sXG4gICAgbXVzdFNvcnQgKG11c3RTb3J0OiBib29sZWFuKSB7XG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBtdXN0U29ydCB9KVxuICAgIH0sXG4gICAgJ2ludGVybmFsT3B0aW9ucy5tdXN0U29ydCcgKG11c3RTb3J0OiBib29sZWFuKSB7XG4gICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6bXVzdC1zb3J0JywgbXVzdFNvcnQpXG4gICAgfSxcbiAgICBwYWdlQ291bnQ6IHtcbiAgICAgIGhhbmRsZXIgKHBhZ2VDb3VudDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuJGVtaXQoJ3BhZ2UtY291bnQnLCBwYWdlQ291bnQpXG4gICAgICB9LFxuICAgICAgaW1tZWRpYXRlOiB0cnVlLFxuICAgIH0sXG4gICAgY29tcHV0ZWRJdGVtczoge1xuICAgICAgaGFuZGxlciAoY29tcHV0ZWRJdGVtczogYW55W10pIHtcbiAgICAgICAgdGhpcy4kZW1pdCgnY3VycmVudC1pdGVtcycsIGNvbXB1dGVkSXRlbXMpXG4gICAgICB9LFxuICAgICAgaW1tZWRpYXRlOiB0cnVlLFxuICAgIH0sXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgaGFuZGxlciAocGFnaW5hdGlvbjogRGF0YVBhZ2luYXRpb24sIG9sZDogRGF0YVBhZ2luYXRpb24pIHtcbiAgICAgICAgaWYgKGRlZXBFcXVhbChwYWdpbmF0aW9uLCBvbGQpKSByZXR1cm5cbiAgICAgICAgdGhpcy4kZW1pdCgncGFnaW5hdGlvbicsIHRoaXMucGFnaW5hdGlvbilcbiAgICAgIH0sXG4gICAgICBpbW1lZGlhdGU6IHRydWUsXG4gICAgfSxcbiAgfSxcblxuICBtZXRob2RzOiB7XG4gICAgdG9nZ2xlIChrZXk6IHN0cmluZywgb2xkQnk6IHN0cmluZ1tdLCBvbGREZXNjOiBib29sZWFuW10sIHBhZ2U6IG51bWJlciwgbXVzdFNvcnQ6IGJvb2xlYW4sIG11bHRpU29ydDogYm9vbGVhbikge1xuICAgICAgbGV0IGJ5ID0gb2xkQnkuc2xpY2UoKVxuICAgICAgbGV0IGRlc2MgPSBvbGREZXNjLnNsaWNlKClcbiAgICAgIGNvbnN0IGJ5SW5kZXggPSBieS5maW5kSW5kZXgoKGs6IHN0cmluZykgPT4gayA9PT0ga2V5KVxuXG4gICAgICBpZiAoYnlJbmRleCA8IDApIHtcbiAgICAgICAgaWYgKCFtdWx0aVNvcnQpIHtcbiAgICAgICAgICBieSA9IFtdXG4gICAgICAgICAgZGVzYyA9IFtdXG4gICAgICAgIH1cblxuICAgICAgICBieS5wdXNoKGtleSlcbiAgICAgICAgZGVzYy5wdXNoKGZhbHNlKVxuICAgICAgfSBlbHNlIGlmIChieUluZGV4ID49IDAgJiYgIWRlc2NbYnlJbmRleF0pIHtcbiAgICAgICAgZGVzY1tieUluZGV4XSA9IHRydWVcbiAgICAgIH0gZWxzZSBpZiAoIW11c3RTb3J0KSB7XG4gICAgICAgIGJ5LnNwbGljZShieUluZGV4LCAxKVxuICAgICAgICBkZXNjLnNwbGljZShieUluZGV4LCAxKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVzY1tieUluZGV4XSA9IGZhbHNlXG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2V0IHBhZ2UgdG8gMSBpZiBzb3J0Qnkgb3Igc29ydERlc2MgaGF2ZSBjaGFuZ2VkXG4gICAgICBpZiAoIWRlZXBFcXVhbChieSwgb2xkQnkpIHx8ICFkZWVwRXF1YWwoZGVzYywgb2xkRGVzYykpIHtcbiAgICAgICAgcGFnZSA9IDFcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgYnksIGRlc2MsIHBhZ2UgfVxuICAgIH0sXG4gICAgZ3JvdXAgKGtleTogc3RyaW5nKTogdm9pZCB7XG4gICAgICBjb25zdCB7IGJ5OiBncm91cEJ5LCBkZXNjOiBncm91cERlc2MsIHBhZ2UgfSA9IHRoaXMudG9nZ2xlKFxuICAgICAgICBrZXksXG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zLmdyb3VwQnksXG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zLmdyb3VwRGVzYyxcbiAgICAgICAgdGhpcy5pbnRlcm5hbE9wdGlvbnMucGFnZSxcbiAgICAgICAgdHJ1ZSxcbiAgICAgICAgZmFsc2VcbiAgICAgIClcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyh7IGdyb3VwQnksIGdyb3VwRGVzYywgcGFnZSB9KVxuICAgIH0sXG4gICAgc29ydCAoa2V5OiBzdHJpbmcgfCBzdHJpbmdbXSk6IHZvaWQge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoa2V5KSkgcmV0dXJuIHRoaXMuc29ydEFycmF5KGtleSlcblxuICAgICAgY29uc3QgeyBieTogc29ydEJ5LCBkZXNjOiBzb3J0RGVzYywgcGFnZSB9ID0gdGhpcy50b2dnbGUoXG4gICAgICAgIGtleSxcbiAgICAgICAgdGhpcy5pbnRlcm5hbE9wdGlvbnMuc29ydEJ5LFxuICAgICAgICB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0RGVzYyxcbiAgICAgICAgdGhpcy5pbnRlcm5hbE9wdGlvbnMucGFnZSxcbiAgICAgICAgdGhpcy5pbnRlcm5hbE9wdGlvbnMubXVzdFNvcnQsXG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zLm11bHRpU29ydFxuICAgICAgKVxuICAgICAgdGhpcy51cGRhdGVPcHRpb25zKHsgc29ydEJ5LCBzb3J0RGVzYywgcGFnZSB9KVxuICAgIH0sXG4gICAgc29ydEFycmF5IChzb3J0Qnk6IHN0cmluZ1tdKSB7XG4gICAgICBjb25zdCBzb3J0RGVzYyA9IHNvcnRCeS5tYXAocyA9PiB7XG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0QnkuZmluZEluZGV4KChrOiBzdHJpbmcpID0+IGsgPT09IHMpXG4gICAgICAgIHJldHVybiBpID4gLTEgPyB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0RGVzY1tpXSA6IGZhbHNlXG4gICAgICB9KVxuXG4gICAgICB0aGlzLnVwZGF0ZU9wdGlvbnMoeyBzb3J0QnksIHNvcnREZXNjIH0pXG4gICAgfSxcbiAgICB1cGRhdGVPcHRpb25zIChvcHRpb25zOiBhbnkpIHtcbiAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zID0ge1xuICAgICAgICAuLi50aGlzLmludGVybmFsT3B0aW9ucyxcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgcGFnZTogdGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA8IDBcbiAgICAgICAgICA/IE1hdGgubWF4KDEsIE1hdGgubWluKG9wdGlvbnMucGFnZSB8fCB0aGlzLmludGVybmFsT3B0aW9ucy5wYWdlLCB0aGlzLnBhZ2VDb3VudCkpXG4gICAgICAgICAgOiBvcHRpb25zLnBhZ2UgfHwgdGhpcy5pbnRlcm5hbE9wdGlvbnMucGFnZSxcbiAgICAgIH1cbiAgICB9LFxuICAgIHNvcnRJdGVtcyAoaXRlbXM6IGFueVtdKSB7XG4gICAgICBsZXQgc29ydEJ5ID0gdGhpcy5pbnRlcm5hbE9wdGlvbnMuc29ydEJ5XG4gICAgICBsZXQgc29ydERlc2MgPSB0aGlzLmludGVybmFsT3B0aW9ucy5zb3J0RGVzY1xuXG4gICAgICBpZiAodGhpcy5pbnRlcm5hbE9wdGlvbnMuZ3JvdXBCeS5sZW5ndGgpIHtcbiAgICAgICAgc29ydEJ5ID0gWy4uLnRoaXMuaW50ZXJuYWxPcHRpb25zLmdyb3VwQnksIC4uLnNvcnRCeV1cbiAgICAgICAgc29ydERlc2MgPSBbLi4udGhpcy5pbnRlcm5hbE9wdGlvbnMuZ3JvdXBEZXNjLCAuLi5zb3J0RGVzY11cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tU29ydChpdGVtcywgc29ydEJ5LCBzb3J0RGVzYywgdGhpcy5sb2NhbGUpXG4gICAgfSxcbiAgICBncm91cEl0ZW1zIChpdGVtczogYW55W10pIHtcbiAgICAgIHJldHVybiB0aGlzLmN1c3RvbUdyb3VwKGl0ZW1zLCB0aGlzLmludGVybmFsT3B0aW9ucy5ncm91cEJ5LCB0aGlzLmludGVybmFsT3B0aW9ucy5ncm91cERlc2MpXG4gICAgfSxcbiAgICBwYWdpbmF0ZUl0ZW1zIChpdGVtczogYW55W10pIHtcbiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBkb24ndCB0cnkgdG8gZGlzcGxheSBub24tZXhpc3RhbnQgcGFnZSBpZiBpdGVtcyBzdWRkZW5seSBjaGFuZ2VcbiAgICAgIC8vIFRPRE86IENvdWxkIHBvc3NpYmx5IG1vdmUgdGhpcyB0byBwYWdlU3RhcnQvcGFnZVN0b3A/XG4gICAgICBpZiAodGhpcy5zZXJ2ZXJJdGVtc0xlbmd0aCA9PT0gLTEgJiYgaXRlbXMubGVuZ3RoIDw9IHRoaXMucGFnZVN0YXJ0KSB7XG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcHRpb25zLnBhZ2UgPSBNYXRoLm1heCgxLCB0aGlzLmludGVybmFsT3B0aW9ucy5wYWdlIC0gMSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGl0ZW1zLnNsaWNlKHRoaXMucGFnZVN0YXJ0LCB0aGlzLnBhZ2VTdG9wKVxuICAgIH0sXG4gIH0sXG5cbiAgcmVuZGVyICgpOiBWTm9kZSB7XG4gICAgcmV0dXJuIHRoaXMuJHNjb3BlZFNsb3RzLmRlZmF1bHQgJiYgdGhpcy4kc2NvcGVkU2xvdHMuZGVmYXVsdCh0aGlzLnNjb3BlZFByb3BzKSBhcyBhbnlcbiAgfSxcbn0pXG4iXX0=