import { colorToInt, intToHex, colorToHex } from '../../util/colorUtils';
import * as sRGB from '../../util/color/transformSRGB';
import * as LAB from '../../util/color/transformCIELAB';
export function parse(theme, isItem = false, variations = true) {
    const { anchor, ...variant } = theme;
    const colors = Object.keys(variant);
    const parsedTheme = {};
    for (let i = 0; i < colors.length; ++i) {
        const name = colors[i];
        const value = theme[name];
        if (value == null)
            continue;
        if (!variations) {
            parsedTheme[name] = { base: intToHex(colorToInt(value)) };
        }
        else if (isItem) {
            /* istanbul ignore else */
            if (name === 'base' || name.startsWith('lighten') || name.startsWith('darken')) {
                parsedTheme[name] = colorToHex(value);
            }
        }
        else if (typeof value === 'object') {
            parsedTheme[name] = parse(value, true, variations);
        }
        else {
            parsedTheme[name] = genVariations(name, colorToInt(value));
        }
    }
    if (!isItem) {
        parsedTheme.anchor = anchor || parsedTheme.base || parsedTheme.primary.base;
    }
    return parsedTheme;
}
/**
 * Generate the CSS for a base color (.primary)
 */
const genBaseColor = (name, value) => {
    return `
.v-application .${name} {
  background-color: ${value} !important;
  border-color: ${value} !important;
}
.v-application .${name}--text {
  color: ${value} !important;
  caret-color: ${value} !important;
}`;
};
/**
 * Generate the CSS for a variant color (.primary.darken-2)
 */
const genVariantColor = (name, variant, value) => {
    const [type, n] = variant.split(/(\d)/, 2);
    return `
.v-application .${name}.${type}-${n} {
  background-color: ${value} !important;
  border-color: ${value} !important;
}
.v-application .${name}--text.text--${type}-${n} {
  color: ${value} !important;
  caret-color: ${value} !important;
}`;
};
const genColorVariableName = (name, variant = 'base') => `--v-${name}-${variant}`;
const genColorVariable = (name, variant = 'base') => `var(${genColorVariableName(name, variant)})`;
export function genStyles(theme, cssVar = false) {
    const { anchor, ...variant } = theme;
    const colors = Object.keys(variant);
    if (!colors.length)
        return '';
    let variablesCss = '';
    let css = '';
    const aColor = cssVar ? genColorVariable('anchor') : anchor;
    css += `.v-application a { color: ${aColor}; }`;
    cssVar && (variablesCss += `  ${genColorVariableName('anchor')}: ${anchor};\n`);
    for (let i = 0; i < colors.length; ++i) {
        const name = colors[i];
        const value = theme[name];
        css += genBaseColor(name, cssVar ? genColorVariable(name) : value.base);
        cssVar && (variablesCss += `  ${genColorVariableName(name)}: ${value.base};\n`);
        const variants = Object.keys(value);
        for (let i = 0; i < variants.length; ++i) {
            const variant = variants[i];
            const variantValue = value[variant];
            if (variant === 'base')
                continue;
            css += genVariantColor(name, variant, cssVar ? genColorVariable(name, variant) : variantValue);
            cssVar && (variablesCss += `  ${genColorVariableName(name, variant)}: ${variantValue};\n`);
        }
    }
    if (cssVar) {
        variablesCss = `:root {\n${variablesCss}}\n\n`;
    }
    return variablesCss + css;
}
export function genVariations(name, value) {
    const values = {
        base: intToHex(value),
    };
    for (let i = 5; i > 0; --i) {
        values[`lighten${i}`] = intToHex(lighten(value, i));
    }
    for (let i = 1; i <= 4; ++i) {
        values[`darken${i}`] = intToHex(darken(value, i));
    }
    return values;
}
export function lighten(value, amount) {
    const lab = LAB.fromXYZ(sRGB.toXYZ(value));
    lab[0] = lab[0] + amount * 10;
    return sRGB.fromXYZ(LAB.toXYZ(lab));
}
export function darken(value, amount) {
    const lab = LAB.fromXYZ(sRGB.toXYZ(value));
    lab[0] = lab[0] - amount * 10;
    return sRGB.fromXYZ(LAB.toXYZ(lab));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2VydmljZXMvdGhlbWUvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFZLE1BQU0sdUJBQXVCLENBQUE7QUFDbEYsT0FBTyxLQUFLLElBQUksTUFBTSxnQ0FBZ0MsQ0FBQTtBQUN0RCxPQUFPLEtBQUssR0FBRyxNQUFNLGtDQUFrQyxDQUFBO0FBTXZELE1BQU0sVUFBVSxLQUFLLENBQ25CLEtBQXVDLEVBQ3ZDLE1BQU0sR0FBRyxLQUFLLEVBQ2QsVUFBVSxHQUFHLElBQUk7SUFFakIsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE9BQU8sRUFBRSxHQUFHLEtBQUssQ0FBQTtJQUNwQyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ25DLE1BQU0sV0FBVyxHQUFRLEVBQUUsQ0FBQTtJQUUzQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtRQUN0QyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDdEIsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRXpCLElBQUksS0FBSyxJQUFJLElBQUk7WUFBRSxTQUFRO1FBRTNCLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUE7U0FDMUQ7YUFBTSxJQUFJLE1BQU0sRUFBRTtZQUNqQiwwQkFBMEI7WUFDMUIsSUFBSSxJQUFJLEtBQUssTUFBTSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDOUUsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQTthQUN0QztTQUNGO2FBQU0sSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDcEMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFBO1NBQ25EO2FBQU07WUFDTCxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsYUFBYSxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtTQUMzRDtLQUNGO0lBRUQsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNYLFdBQVcsQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLFdBQVcsQ0FBQyxJQUFJLElBQUksV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUE7S0FDNUU7SUFFRCxPQUFPLFdBQVcsQ0FBQTtBQUNwQixDQUFDO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLFlBQVksR0FBRyxDQUFDLElBQVksRUFBRSxLQUFhLEVBQVUsRUFBRTtJQUMzRCxPQUFPO2tCQUNTLElBQUk7c0JBQ0EsS0FBSztrQkFDVCxLQUFLOztrQkFFTCxJQUFJO1dBQ1gsS0FBSztpQkFDQyxLQUFLO0VBQ3BCLENBQUE7QUFDRixDQUFDLENBQUE7QUFFRDs7R0FFRztBQUNILE1BQU0sZUFBZSxHQUFHLENBQUMsSUFBWSxFQUFFLE9BQWUsRUFBRSxLQUFhLEVBQVUsRUFBRTtJQUMvRSxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQzFDLE9BQU87a0JBQ1MsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDO3NCQUNiLEtBQUs7a0JBQ1QsS0FBSzs7a0JBRUwsSUFBSSxnQkFBZ0IsSUFBSSxJQUFJLENBQUM7V0FDcEMsS0FBSztpQkFDQyxLQUFLO0VBQ3BCLENBQUE7QUFDRixDQUFDLENBQUE7QUFFRCxNQUFNLG9CQUFvQixHQUFHLENBQUMsSUFBWSxFQUFFLE9BQU8sR0FBRyxNQUFNLEVBQVUsRUFBRSxDQUFDLE9BQU8sSUFBSSxJQUFJLE9BQU8sRUFBRSxDQUFBO0FBRWpHLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxJQUFZLEVBQUUsT0FBTyxHQUFHLE1BQU0sRUFBVSxFQUFFLENBQUMsT0FBTyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQTtBQUVsSCxNQUFNLFVBQVUsU0FBUyxDQUFFLEtBQXlCLEVBQUUsTUFBTSxHQUFHLEtBQUs7SUFDbEUsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE9BQU8sRUFBRSxHQUFHLEtBQUssQ0FBQTtJQUNwQyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBRW5DLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTtRQUFFLE9BQU8sRUFBRSxDQUFBO0lBRTdCLElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQTtJQUNyQixJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUE7SUFFWixNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUE7SUFDM0QsR0FBRyxJQUFJLDZCQUE2QixNQUFNLEtBQUssQ0FBQTtJQUMvQyxNQUFNLElBQUksQ0FBQyxZQUFZLElBQUksS0FBSyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsS0FBSyxNQUFNLEtBQUssQ0FBQyxDQUFBO0lBRS9FLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1FBQ3RDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUN0QixNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFekIsR0FBRyxJQUFJLFlBQVksQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ3ZFLE1BQU0sSUFBSSxDQUFDLFlBQVksSUFBSSxLQUFLLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFBO1FBRS9FLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDbkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDeEMsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQzNCLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUNuQyxJQUFJLE9BQU8sS0FBSyxNQUFNO2dCQUFFLFNBQVE7WUFFaEMsR0FBRyxJQUFJLGVBQWUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQTtZQUM5RixNQUFNLElBQUksQ0FBQyxZQUFZLElBQUksS0FBSyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQTtTQUMzRjtLQUNGO0lBRUQsSUFBSSxNQUFNLEVBQUU7UUFDVixZQUFZLEdBQUcsWUFBWSxZQUFZLE9BQU8sQ0FBQTtLQUMvQztJQUVELE9BQU8sWUFBWSxHQUFHLEdBQUcsQ0FBQTtBQUMzQixDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWEsQ0FBRSxJQUFZLEVBQUUsS0FBZTtJQUMxRCxNQUFNLE1BQU0sR0FBMkI7UUFDckMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUM7S0FDdEIsQ0FBQTtJQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDMUIsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO0tBQ3BEO0lBRUQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRTtRQUMzQixNQUFNLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDbEQ7SUFFRCxPQUFPLE1BQU0sQ0FBQTtBQUNmLENBQUM7QUFFRCxNQUFNLFVBQVUsT0FBTyxDQUFFLEtBQWUsRUFBRSxNQUFjO0lBQ3RELE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQzFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUM3QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQ3JDLENBQUM7QUFFRCxNQUFNLFVBQVUsTUFBTSxDQUFFLEtBQWUsRUFBRSxNQUFjO0lBQ3JELE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQzFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUM3QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQ3JDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb2xvclRvSW50LCBpbnRUb0hleCwgY29sb3JUb0hleCwgQ29sb3JJbnQgfSBmcm9tICcuLi8uLi91dGlsL2NvbG9yVXRpbHMnXG5pbXBvcnQgKiBhcyBzUkdCIGZyb20gJy4uLy4uL3V0aWwvY29sb3IvdHJhbnNmb3JtU1JHQidcbmltcG9ydCAqIGFzIExBQiBmcm9tICcuLi8uLi91dGlsL2NvbG9yL3RyYW5zZm9ybUNJRUxBQidcbmltcG9ydCB7XG4gIFZ1ZXRpZnlQYXJzZWRUaGVtZSxcbiAgVnVldGlmeVRoZW1lSXRlbSxcbn0gZnJvbSAndnVldGlmeS90eXBlcy9zZXJ2aWNlcy90aGVtZSdcblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlIChcbiAgdGhlbWU6IFJlY29yZDxzdHJpbmcsIFZ1ZXRpZnlUaGVtZUl0ZW0+LFxuICBpc0l0ZW0gPSBmYWxzZSxcbiAgdmFyaWF0aW9ucyA9IHRydWUsXG4pOiBWdWV0aWZ5UGFyc2VkVGhlbWUge1xuICBjb25zdCB7IGFuY2hvciwgLi4udmFyaWFudCB9ID0gdGhlbWVcbiAgY29uc3QgY29sb3JzID0gT2JqZWN0LmtleXModmFyaWFudClcbiAgY29uc3QgcGFyc2VkVGhlbWU6IGFueSA9IHt9XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xvcnMubGVuZ3RoOyArK2kpIHtcbiAgICBjb25zdCBuYW1lID0gY29sb3JzW2ldXG4gICAgY29uc3QgdmFsdWUgPSB0aGVtZVtuYW1lXVxuXG4gICAgaWYgKHZhbHVlID09IG51bGwpIGNvbnRpbnVlXG5cbiAgICBpZiAoIXZhcmlhdGlvbnMpIHtcbiAgICAgIHBhcnNlZFRoZW1lW25hbWVdID0geyBiYXNlOiBpbnRUb0hleChjb2xvclRvSW50KHZhbHVlKSkgfVxuICAgIH0gZWxzZSBpZiAoaXNJdGVtKSB7XG4gICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqL1xuICAgICAgaWYgKG5hbWUgPT09ICdiYXNlJyB8fCBuYW1lLnN0YXJ0c1dpdGgoJ2xpZ2h0ZW4nKSB8fCBuYW1lLnN0YXJ0c1dpdGgoJ2RhcmtlbicpKSB7XG4gICAgICAgIHBhcnNlZFRoZW1lW25hbWVdID0gY29sb3JUb0hleCh2YWx1ZSlcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHBhcnNlZFRoZW1lW25hbWVdID0gcGFyc2UodmFsdWUsIHRydWUsIHZhcmlhdGlvbnMpXG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcnNlZFRoZW1lW25hbWVdID0gZ2VuVmFyaWF0aW9ucyhuYW1lLCBjb2xvclRvSW50KHZhbHVlKSlcbiAgICB9XG4gIH1cblxuICBpZiAoIWlzSXRlbSkge1xuICAgIHBhcnNlZFRoZW1lLmFuY2hvciA9IGFuY2hvciB8fCBwYXJzZWRUaGVtZS5iYXNlIHx8IHBhcnNlZFRoZW1lLnByaW1hcnkuYmFzZVxuICB9XG5cbiAgcmV0dXJuIHBhcnNlZFRoZW1lXG59XG5cbi8qKlxuICogR2VuZXJhdGUgdGhlIENTUyBmb3IgYSBiYXNlIGNvbG9yICgucHJpbWFyeSlcbiAqL1xuY29uc3QgZ2VuQmFzZUNvbG9yID0gKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gIHJldHVybiBgXG4udi1hcHBsaWNhdGlvbiAuJHtuYW1lfSB7XG4gIGJhY2tncm91bmQtY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XG4gIGJvcmRlci1jb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcbn1cbi52LWFwcGxpY2F0aW9uIC4ke25hbWV9LS10ZXh0IHtcbiAgY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XG4gIGNhcmV0LWNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xufWBcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSB0aGUgQ1NTIGZvciBhIHZhcmlhbnQgY29sb3IgKC5wcmltYXJ5LmRhcmtlbi0yKVxuICovXG5jb25zdCBnZW5WYXJpYW50Q29sb3IgPSAobmFtZTogc3RyaW5nLCB2YXJpYW50OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBbdHlwZSwgbl0gPSB2YXJpYW50LnNwbGl0KC8oXFxkKS8sIDIpXG4gIHJldHVybiBgXG4udi1hcHBsaWNhdGlvbiAuJHtuYW1lfS4ke3R5cGV9LSR7bn0ge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xuICBib3JkZXItY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XG59XG4udi1hcHBsaWNhdGlvbiAuJHtuYW1lfS0tdGV4dC50ZXh0LS0ke3R5cGV9LSR7bn0ge1xuICBjb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcbiAgY2FyZXQtY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XG59YFxufVxuXG5jb25zdCBnZW5Db2xvclZhcmlhYmxlTmFtZSA9IChuYW1lOiBzdHJpbmcsIHZhcmlhbnQgPSAnYmFzZScpOiBzdHJpbmcgPT4gYC0tdi0ke25hbWV9LSR7dmFyaWFudH1gXG5cbmNvbnN0IGdlbkNvbG9yVmFyaWFibGUgPSAobmFtZTogc3RyaW5nLCB2YXJpYW50ID0gJ2Jhc2UnKTogc3RyaW5nID0+IGB2YXIoJHtnZW5Db2xvclZhcmlhYmxlTmFtZShuYW1lLCB2YXJpYW50KX0pYFxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuU3R5bGVzICh0aGVtZTogVnVldGlmeVBhcnNlZFRoZW1lLCBjc3NWYXIgPSBmYWxzZSk6IHN0cmluZyB7XG4gIGNvbnN0IHsgYW5jaG9yLCAuLi52YXJpYW50IH0gPSB0aGVtZVxuICBjb25zdCBjb2xvcnMgPSBPYmplY3Qua2V5cyh2YXJpYW50KVxuXG4gIGlmICghY29sb3JzLmxlbmd0aCkgcmV0dXJuICcnXG5cbiAgbGV0IHZhcmlhYmxlc0NzcyA9ICcnXG4gIGxldCBjc3MgPSAnJ1xuXG4gIGNvbnN0IGFDb2xvciA9IGNzc1ZhciA/IGdlbkNvbG9yVmFyaWFibGUoJ2FuY2hvcicpIDogYW5jaG9yXG4gIGNzcyArPSBgLnYtYXBwbGljYXRpb24gYSB7IGNvbG9yOiAke2FDb2xvcn07IH1gXG4gIGNzc1ZhciAmJiAodmFyaWFibGVzQ3NzICs9IGAgICR7Z2VuQ29sb3JWYXJpYWJsZU5hbWUoJ2FuY2hvcicpfTogJHthbmNob3J9O1xcbmApXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xvcnMubGVuZ3RoOyArK2kpIHtcbiAgICBjb25zdCBuYW1lID0gY29sb3JzW2ldXG4gICAgY29uc3QgdmFsdWUgPSB0aGVtZVtuYW1lXVxuXG4gICAgY3NzICs9IGdlbkJhc2VDb2xvcihuYW1lLCBjc3NWYXIgPyBnZW5Db2xvclZhcmlhYmxlKG5hbWUpIDogdmFsdWUuYmFzZSlcbiAgICBjc3NWYXIgJiYgKHZhcmlhYmxlc0NzcyArPSBgICAke2dlbkNvbG9yVmFyaWFibGVOYW1lKG5hbWUpfTogJHt2YWx1ZS5iYXNlfTtcXG5gKVxuXG4gICAgY29uc3QgdmFyaWFudHMgPSBPYmplY3Qua2V5cyh2YWx1ZSlcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhcmlhbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICBjb25zdCB2YXJpYW50ID0gdmFyaWFudHNbaV1cbiAgICAgIGNvbnN0IHZhcmlhbnRWYWx1ZSA9IHZhbHVlW3ZhcmlhbnRdXG4gICAgICBpZiAodmFyaWFudCA9PT0gJ2Jhc2UnKSBjb250aW51ZVxuXG4gICAgICBjc3MgKz0gZ2VuVmFyaWFudENvbG9yKG5hbWUsIHZhcmlhbnQsIGNzc1ZhciA/IGdlbkNvbG9yVmFyaWFibGUobmFtZSwgdmFyaWFudCkgOiB2YXJpYW50VmFsdWUpXG4gICAgICBjc3NWYXIgJiYgKHZhcmlhYmxlc0NzcyArPSBgICAke2dlbkNvbG9yVmFyaWFibGVOYW1lKG5hbWUsIHZhcmlhbnQpfTogJHt2YXJpYW50VmFsdWV9O1xcbmApXG4gICAgfVxuICB9XG5cbiAgaWYgKGNzc1Zhcikge1xuICAgIHZhcmlhYmxlc0NzcyA9IGA6cm9vdCB7XFxuJHt2YXJpYWJsZXNDc3N9fVxcblxcbmBcbiAgfVxuXG4gIHJldHVybiB2YXJpYWJsZXNDc3MgKyBjc3Ncbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlblZhcmlhdGlvbnMgKG5hbWU6IHN0cmluZywgdmFsdWU6IENvbG9ySW50KTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XG4gIGNvbnN0IHZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICBiYXNlOiBpbnRUb0hleCh2YWx1ZSksXG4gIH1cblxuICBmb3IgKGxldCBpID0gNTsgaSA+IDA7IC0taSkge1xuICAgIHZhbHVlc1tgbGlnaHRlbiR7aX1gXSA9IGludFRvSGV4KGxpZ2h0ZW4odmFsdWUsIGkpKVxuICB9XG5cbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gNDsgKytpKSB7XG4gICAgdmFsdWVzW2BkYXJrZW4ke2l9YF0gPSBpbnRUb0hleChkYXJrZW4odmFsdWUsIGkpKVxuICB9XG5cbiAgcmV0dXJuIHZhbHVlc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbGlnaHRlbiAodmFsdWU6IENvbG9ySW50LCBhbW91bnQ6IG51bWJlcik6IENvbG9ySW50IHtcbiAgY29uc3QgbGFiID0gTEFCLmZyb21YWVooc1JHQi50b1hZWih2YWx1ZSkpXG4gIGxhYlswXSA9IGxhYlswXSArIGFtb3VudCAqIDEwXG4gIHJldHVybiBzUkdCLmZyb21YWVooTEFCLnRvWFlaKGxhYikpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkYXJrZW4gKHZhbHVlOiBDb2xvckludCwgYW1vdW50OiBudW1iZXIpOiBDb2xvckludCB7XG4gIGNvbnN0IGxhYiA9IExBQi5mcm9tWFlaKHNSR0IudG9YWVoodmFsdWUpKVxuICBsYWJbMF0gPSBsYWJbMF0gLSBhbW91bnQgKiAxMFxuICByZXR1cm4gc1JHQi5mcm9tWFlaKExBQi50b1hZWihsYWIpKVxufVxuIl19